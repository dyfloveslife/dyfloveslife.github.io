<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Java 中的 Thread - Carol&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Carol" /><meta name="description" content="本文主要介绍 Thread 类中线程的六种状态以及各状态之间转换的方法，如 wait()、start()、run()、sleep() 等。在阐述线程的生命周期的同时，解释各个方法是如何使线程的状态进行转换的，以及在转换的过程中是否需要释放锁等问题。
" /><meta name="keywords" content="Java, blog, carol" />






<meta name="generator" content="Hugo 0.84.0 with theme even" />


<link rel="canonical" href="http://localhost:1313/2020/03/17/JavaSrc-Thread/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.a289a5a4.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Java 中的 Thread" />
<meta property="og:description" content="本文主要介绍 Thread 类中线程的六种状态以及各状态之间转换的方法，如 wait()、start()、run()、sleep() 等。在阐述线程的生命周期的同时，解释各个方法是如何使线程的状态进行转换的，以及在转换的过程中是否需要释放锁等问题。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/2020/03/17/JavaSrc-Thread/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-03-17T16:35:11&#43;08:00" />
<meta property="article:modified_time" content="2020-03-18T22:40:11&#43;08:00" />

<meta itemprop="name" content="Java 中的 Thread">
<meta itemprop="description" content="本文主要介绍 Thread 类中线程的六种状态以及各状态之间转换的方法，如 wait()、start()、run()、sleep() 等。在阐述线程的生命周期的同时，解释各个方法是如何使线程的状态进行转换的，以及在转换的过程中是否需要释放锁等问题。"><meta itemprop="datePublished" content="2020-03-17T16:35:11&#43;08:00" />
<meta itemprop="dateModified" content="2020-03-18T22:40:11&#43;08:00" />
<meta itemprop="wordCount" content="6003">
<meta itemprop="keywords" content="Java,JDK,Thread,线程,进程," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java 中的 Thread"/>
<meta name="twitter:description" content="本文主要介绍 Thread 类中线程的六种状态以及各状态之间转换的方法，如 wait()、start()、run()、sleep() 等。在阐述线程的生命周期的同时，解释各个方法是如何使线程的状态进行转换的，以及在转换的过程中是否需要释放锁等问题。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Carol&#39;s blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Carol&#39;s blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Java 中的 Thread</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-03-17 </span>
        <div class="post-category">
            <a href="/categories/Java/"> Java </a>
            </div>
          <span class="more-meta"> 6003 words </span>
          <span class="more-meta"> 12 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#start-方法">start() 方法</a></li>
    <li><a href="#run-方法">run() 方法</a></li>
    <li><a href="#sleep-方法">sleep() 方法</a></li>
    <li><a href="#yield-方法">yield() 方法</a></li>
    <li><a href="#join-方法">join() 方法</a></li>
    <li><a href="#interrupt-方法">interrupt() 方法</a></li>
    <li><a href="#其它方法">其它方法</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>本文主要介绍 Thread 类中线程的六种状态以及各状态之间转换的方法，如 wait()、start()、run()、sleep() 等。在阐述线程的生命周期的同时，解释各个方法是如何使线程的状态进行转换的，以及在转换的过程中是否需要释放锁等问题。</p>
<h1 id="进程和线程">进程和线程</h1>
<p>一开始的时候并没有<code>进程</code>和<code>线程</code>之类的概念，计算机就是完成很简单的输入、计算、输出操作。然而，我们将数据输入到计算机中的这个过程，其实计算机一直在那里处于等待用户输入的状态，这显然效率很低。然后人们开始将需要执行的指令写入到硬盘等存储介质中，将这些指令一次性交给计算机去执行，这样的话，计算机就会不断的读取指令来进行相关的操作，这种操作方式称为批处理系统。</p>
<p>批处理系统虽然解决了等待用户输入时的性能问题，但计算机只能同时执行一个任务，如果现在有两个任务，一个任务在执行到一半的时候，需要进行大量的 I/O 操作，此时 CPU 只能<code>等待</code>该任务读取完数据之后才能继续执行，这个过程中的等待操作无疑是给白白的浪费了。那么有没有一种机制或者方式可以让一个任务在读取数据的时候让另一个任务去执行，即让另一个任务使用此时空闲下来的 CPU 去执行操作？还有，即使是让一个任务执行到一半的时候让另一个任务去执行，那么该任务执行以后如何再回到之前的任务继续执行下去呢？即如何回到之前执行到一半的时候的状态？</p>
<p>为了进一步提升计算机的运行效率，则引入了进程的概念。一个进行就对应计算机中的一个任务（程序）。每个进行都拥有自己独立的内存空间，各个进行之间互不干扰。当进程暂停时，它会保存当前进程的状态（如进程标识、进程的使用资源等），等待再次切换回来的时候，会根据之前的状态信息进行恢复，继而执行。</p>
<p>多个进程之间是可以进行通信的，这会使得程序设计的更加灵活。多进程的出现使得一个 CPU 可以<code>同时</code>执行多个不同的程序。这里的<code>同时</code>指的是：对于单个 CPU 来说，它在执行操作的时候会将时间片分给每一个进程，当某个进程执行完（时间片完）之后操作系统会负责调度 CPU 执行另一个进程。但由于时间片的非常小，使得给人的感觉就像是多个程序在<code>同时</code>执行一样。即从同一个时间段上看有多个任务在执行，这就是所谓的并发。因此，<strong>进程让操作系统的并发成为了可能</strong>。</p>
<p>为了满足<strong>实时性</strong>的要求，线程就诞生了。也就是说，在很多情况下，一个程序的内部中的会存在多个子任务，这些子任务之间可以并行执行。线程是对子任务的抽象表示，一个进程可以有多个子任务在同时执行，这些子任务会共享同一个进程中的资源和地址空间等数据。也就是说，一个进程可以包含多个线程，每个线程可以负责一个独立的子任务。因此，<strong>线程让进程的内部并发成为可能</strong>。</p>
<p>对于多核 CPU 来说，操作系统负责将不容的线程调度到多个 CPU 上执行，可以实现真正意义上的并行执行。</p>
<p>综上所述：</p>
<ul>
<li><strong>进程</strong>是操作系统进行<strong>资源分配</strong>的基本单位，而<strong>线程</strong>是操作系统进行<strong>调度</strong>的基本单位。</li>
<li><strong>进程</strong>是对运行时程序的封装，可以保存程序的运行状态，实现操作系统的并发，而<strong>线程</strong>是进程的子任务，能够保证程序的实时性。</li>
<li><strong>进程</strong>让操作系统的并发成为可能，而<strong>线程</strong>让进行的内部并发成为可能。</li>
</ul>
<h1 id="线程的状态">线程的状态</h1>
<p>从线程的创建到消亡，需要经过若干个不同的状态：创建、就绪、运行、阻塞、等待、时间等待、消亡。而在<code>java.lang.Thread</code>里的内部枚举类<code>State</code>中定义了线程的 6 种状态，分别代表线程的<code>创建(NEW)</code>、<code>就绪/可运行(RUNNABLE)</code>、<code>阻塞(BLOCKED)</code>、<code>等待(WAITING)</code>、<code>时间等待(TIMED_WAITING)</code>以及<code>消亡(TERMINATED)</code>，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">State</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">    * Thread state for a thread which has not yet started.
</span><span class="cm">    */</span>
    <span class="n">NEW</span><span class="o">,</span>

    <span class="cm">/**
</span><span class="cm">    * Thread state for a runnable thread.  A thread in the runnable
</span><span class="cm">    * state is executing in the Java virtual machine but it may
</span><span class="cm">    * be waiting for other resources from the operating system
</span><span class="cm">    * such as processor.
</span><span class="cm">    */</span>
    <span class="n">RUNNABLE</span><span class="o">,</span>

    <span class="cm">/**
</span><span class="cm">    * Thread state for a thread blocked waiting for a monitor lock.
</span><span class="cm">    */</span>
    <span class="n">BLOCKED</span><span class="o">,</span>

    <span class="cm">/**
</span><span class="cm">    * Thread state for a waiting thread.
</span><span class="cm">    */</span>
    <span class="n">WAITING</span><span class="o">,</span>

    <span class="cm">/**
</span><span class="cm">    * Thread state for a waiting thread with a specified waiting time.
</span><span class="cm">    */</span>
    <span class="n">TIMED_WAITING</span><span class="o">,</span>

    <span class="cm">/**
</span><span class="cm">    * Thread state for a terminated thread.
</span><span class="cm">    * The thread has completed execution.
</span><span class="cm">    */</span>
    <span class="n">TERMINATED</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>线程在真正进入运行状态之前需要一些条件，在创建线程后，如果能满足线程运行所需要的条件（程序计数器、本地方法栈）的话，则会先进入就绪状态，进入就绪状态的线程如果能够获得 CPU 所分配的时间片的话，才会进入运行状态。如下图所示：</p>
<p><img src="https://i.loli.net/2020/03/18/Gx8a2XFrHzmPBho.png" alt="image.png"></p>
<h1 id="创建线程的方式">创建线程的方式</h1>
<p>在之前的<a href="https://dyfloveslife.github.io/2020/03/10/Java_Concurrency/">《Java 并发编程-更新中》</a>文章中提到了创建线程的方式：</p>
<ul>
<li>一种是继承 Thread 类，重写其中的 run() 方法，在 run() 方法中定义需要执行的任务，然后调用 start() 方法执行线程；
<ul>
<li>其中 Thread 类本身就实现了 Runnable 接口，该方式的局限性是不支持多继承。</li>
</ul>
</li>
<li>另一种是实现 Runnable 接口，重写 run() 方法，然后 new 一个 Runnable 实例作为参数传递给 Thread 类，最后还是通过 start() 方法启动线程。</li>
</ul>
<p>如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestThread</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Thread.&#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Runnable.&#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;main.&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// 程序最后输出的结果，与代码的运行顺序或调用顺序无关。
</span></code></pre></td></tr></table>
</div>
</div><p><strong>关于 run() 方法和 start() 方法的区别</strong>？</p>
<p>线程的启动并不是简单的调用了 run() 方法， 而是由一个<strong>线程调度器</strong>来分别调用所有线程的 run() 方法。如果自己写一个普通的 run() 方法，该方法如果没有执行完是不会返回的，会一直执行下去，这就会造成 run() 方法下面的方法就不可能会执行了。而线程中的 run() 方法缺不一样，CPU 会给该线程分配时间片，该线程只有一定的 CPU 时间，执行完以后时间片就会交给其它线程，由于时间很短、切换速度快，所以我们就感觉像是很多线程在同时运行一样。</p>
<p>假如 new 了一个线程对象<code>Thread thread = new Thread();</code>，如果执行<code>thread.run();</code>，此时就相当于在<code>主线程 main</code>中调用的，该 run() 方法是运行在<code>主线程 main</code>上的，跟普通的方法没有什么区别，此时并不会创建一个新的线程来执行任务。</p>
<p>而执行<code>thread.start()</code>的话，会启动<code>thread</code>线程，<code>thread</code>线程启动后，会调用 run() 方法，此时的 run() 方法是运行在<code>thread</code>上的。所以说，start() 方法的作用是通知<code>线程规划器（或线程调度器）</code>，该线程已经准备就绪了，以便让操作系统安排一个时间来调用其 run() 方法，使线程得到运行。</p>
<h1 id="thread-类">Thread 类</h1>
<p>为了方便查看调用线程的某个方法后该线程会处于哪种状态，在此将线程状态转换图给出。虽然文章开头已经给出了更为详细的转换图，但下图更为简单直观一些：</p>
<p><img src="https://i.loli.net/2020/03/18/pJkHxFrIj12ObXE.png" alt="image.png"></p>
<p>Thread 类实现了 Runnable 接口，在 Thread 中有一些比较重要的属性，如被关键字 volatile 修饰的<code>name</code>表示线程的名字，<code>priority</code>表示线程的优先级（默认为 5，最小为 1，最大为 10），<code>target</code>表示要执行的任务等等。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Thread</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
    <span class="cm">/* Make sure registerNatives is the first thing &lt;clinit&gt; does. */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">registerNatives</span><span class="o">();</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">registerNatives</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">volatile</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span>            <span class="n">priority</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Thread</span>         <span class="n">threadQ</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">long</span>           <span class="n">eetop</span><span class="o">;</span>

    <span class="cm">/* Whether or not to single_step this thread. */</span>
    <span class="kd">private</span> <span class="kt">boolean</span>     <span class="n">single_step</span><span class="o">;</span>

    <span class="cm">/* Whether or not the thread is a daemon thread. */</span>
    <span class="kd">private</span> <span class="kt">boolean</span>     <span class="n">daemon</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="cm">/* JVM state */</span>
    <span class="kd">private</span> <span class="kt">boolean</span>     <span class="n">stillborn</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="cm">/* What will be run. */</span>
    <span class="kd">private</span> <span class="n">Runnable</span> <span class="n">target</span><span class="o">;</span>

    <span class="cm">/* The group of this thread */</span>
    <span class="kd">private</span> <span class="n">ThreadGroup</span> <span class="n">group</span><span class="o">;</span>

    <span class="cm">/* The context ClassLoader for this thread */</span>
    <span class="kd">private</span> <span class="n">ClassLoader</span> <span class="n">contextClassLoader</span><span class="o">;</span>

    <span class="cm">/* The inherited AccessControlContext of this thread */</span>
    <span class="kd">private</span> <span class="n">AccessControlContext</span> <span class="n">inheritedAccessControlContext</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="start-方法">start() 方法</h2>
<p>由最上面的线程状态转换图所示，当调用了 start() 方法后，表示启动一个线程，该线程进入就绪（可运行）状态，此时系统才会开启一个新的线程来执行用户定义的子任务，为响应的线程分配所需要的资源。此方法被调用以后，该线程中的 run() 方法会在某个时机被调用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">threadStatus</span> <span class="o">!=</span> <span class="n">0</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalThreadStateException</span><span class="o">();</span>

    <span class="n">group</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>

    <span class="kt">boolean</span> <span class="n">started</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">start0</span><span class="o">();</span>
        <span class="n">started</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">started</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">group</span><span class="o">.</span><span class="na">threadStartFailed</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ignore</span><span class="o">)</span> <span class="o">{</span>
            <span class="cm">/* do nothing. If start0 threw a Throwable then
</span><span class="cm">                it will be passed up the call stack */</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="run-方法">run() 方法</h2>
<p>run() 方法不需要用户来调用，当通过调用线程的 start() 方法后，一旦该线程获得了 CPU 给它分配的时间片，便会进入 run() 方法体去执行具体的任务。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 创建线程时，必须重写此方法！！！
</span><span class="c1"></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">target</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">target</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="sleep-方法">sleep() 方法</h2>
<p>有两个重载的 sleep() 方法，该方法的作用是在指定的毫秒时间内让当前正在运行的线程睡眠，交出 CPU 让其去执行其它任务。当线程睡眠时间满了以后，不一定会立即得到执行，还得看 CPU 有没有在执行其它任务。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">sleep</span><span class="o">(</span><span class="kt">long</span> <span class="n">millis</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sleep</span><span class="o">(</span><span class="kt">long</span> <span class="n">millis</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nanos</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">millis</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;timeout value is negative&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">nanos</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">||</span> <span class="n">nanos</span> <span class="o">&gt;</span> <span class="n">999999</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;nanosecond timeout value out of range&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">nanos</span> <span class="o">&gt;=</span> <span class="n">500000</span> <span class="o">||</span> <span class="o">(</span><span class="n">nanos</span> <span class="o">!=</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="n">millis</span> <span class="o">==</span> <span class="n">0</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">millis</span><span class="o">++;</span>
    <span class="o">}</span>

    <span class="n">sleep</span><span class="o">(</span><span class="n">millis</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>对于 sleep() 方法需要注意的是：</p>
<ul>
<li>如果存在任何线程中断了当前线程，则会抛出<code>InterruptedException</code>异常，而当该异常抛出的时候，当前线程的中断状态就会被清除。因此如果调用了 sleep() 方法，则需要捕获<code>InterruptedException</code>异常或向上抛出。</li>
<li>此外，sleep() 方法不会释放锁，即如果当前线程持有某个对象的锁，即使调用 sleep() 方法，其它线程也无法访问该对象。</li>
</ul>
<h2 id="yield-方法">yield() 方法</h2>
<p>yield 就是让步的意思，调用 yield() 后会让当前线程交出 CPU 资源，让 CPU 去执行其它线程。需要注意的是：</p>
<ul>
<li>yield() 方法不能控制交出 CPU 的具体时间，只能让拥有相同优先级的线程具有获得 CPU 执行时间的机会；</li>
<li>调用了 yield() 方法后，并不会让线程进入阻塞状态，而是让线程重新回到就绪/可运行状态，此时需要等待重新得到 CPU 的执行；</li>
<li>调用 yield() 方法后不会释放锁。</li>
</ul>
<p>yield() 是一个静态的本地方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">yield</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="join-方法">join() 方法</h2>
<p>当调用 join() 后，当前线程会从运行状态转换为等待状态，而调用有参的 join() 方法后，线程会在睡眠时间期限已满后进入就绪状态。join() 有三个重载的方法，其中需要注意的是：join() 调用的是 join(0) 方法，而在 join(0) 方法中，实际上调用的是 Object 类中的 wait(0) 方法，此时就意味着线程会永远等待，直至当前线程被唤醒。</p>
<p>也就是说，Object 类中的本地方法 wait() 会造成当前线程一直等待，直到另一个线程调用此对象的 notify() 或 notify() 方法，或者经过了指定的时间之后，当前线程才会进入就绪/可运行状态。此外，当前线程调用了 wait() 方法后会获得当前对象的锁。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">join</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="n">join</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
<span class="o">}</span>


<span class="kd">public</span> <span class="kd">final</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">join</span><span class="o">(</span><span class="kt">long</span> <span class="n">millis</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">base</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
    <span class="kt">long</span> <span class="n">now</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">millis</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;timeout value is negative&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">millis</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">isAlive</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">wait</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">isAlive</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">delay</span> <span class="o">=</span> <span class="n">millis</span> <span class="o">-</span> <span class="n">now</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">delay</span> <span class="o">&lt;=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">wait</span><span class="o">(</span><span class="n">delay</span><span class="o">);</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">base</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="kd">public</span> <span class="kd">final</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">join</span><span class="o">(</span><span class="kt">long</span> <span class="n">millis</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nanos</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">millis</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;timeout value is negative&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">nanos</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">||</span> <span class="n">nanos</span> <span class="o">&gt;</span> <span class="n">999999</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;nanosecond timeout value out of range&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">nanos</span> <span class="o">&gt;=</span> <span class="n">500000</span> <span class="o">||</span> <span class="o">(</span><span class="n">nanos</span> <span class="o">!=</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="n">millis</span> <span class="o">==</span> <span class="n">0</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">millis</span><span class="o">++;</span>
    <span class="o">}</span>

    <span class="n">join</span><span class="o">(</span><span class="n">millis</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>下面通过一个实例来理解 join() 方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WaitMethodInThreadTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;进入线程: &#34;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>

        <span class="n">ThreadDemo</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadDemo</span><span class="o">();</span>
        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;线程:&#34;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; 等待.&#34;</span><span class="o">);</span>
            <span class="n">thread1</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;线程:&#34;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; 继续执行.&#34;</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">ThreadDemo</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;进入线程: &#34;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">5000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;线程: &#34;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; 执行完毕.&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nl">进入线程:</span> <span class="n">main</span>
<span class="nl">线程:</span><span class="n">main</span> <span class="n">等待</span><span class="o">.</span>
<span class="nl">进入线程:</span> <span class="n">Thread</span><span class="o">-</span><span class="n">0</span>
<span class="nl">线程:</span> <span class="n">Thread</span><span class="o">-</span><span class="n">0</span> <span class="n">执行完毕</span><span class="o">.</span>
<span class="nl">线程:</span><span class="n">main</span> <span class="n">继续执行</span><span class="o">.</span>
</code></pre></td></tr></table>
</div>
</div><p>通过现象可以看到，当调用<code>thread1.join();</code>方法后，main 线程会进入等待，然后等待 thread1 执行完以后再继续执行。</p>
<p>也就是说，当 main 线程运行到<code>thread1.join();</code>的时候，main 线程会获得线程对象<code>thread1</code>的锁，意味着 join() 中的 wait() 方法会得到该对象的锁，只要<code>thread1</code>线程一直存活，就会调用该对象锁的 wait() 方法阻塞 main 线程，之后 main 
线程会被 notity() 方法唤醒，至此结束。</p>
<p>因此，wait() 方法会让 main 线程进入阻塞状态，并且会释放 main 线程所占有的锁，让 main 线程交出 CPU 执行权限，此时 thread1 线程就会获得 CPU 的执行权，等到 thread1 执行完毕后，main 线程才继续执行。</p>
<h2 id="interrupt-方法">interrupt() 方法</h2>
<p>即中断此线程，该方法可以使处于<strong>阻塞状态</strong>的线程抛出一个异常，即该方法可以中断一个正在处于阻塞状态的线程。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">interrupt</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">!=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">())</span>
        <span class="n">checkAccess</span><span class="o">();</span>

    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">blockerLock</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Interruptible</span> <span class="n">b</span> <span class="o">=</span> <span class="n">blocker</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">b</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">interrupt0</span><span class="o">();</span>  <span class="c1">// Just to set the interrupt flag
</span><span class="c1"></span>            <span class="n">b</span><span class="o">.</span><span class="na">interrupt</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">interrupt0</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>下面通过一个示例说明 interrupt() 方法可以中断处于<strong>阻塞状态</strong>的线程：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InterruptMethodInThreadTest</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">InterruptThread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InterruptThread</span><span class="o">();</span>
        <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">thread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">InterruptThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;进入睡眠状态...&#34;</span><span class="o">);</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">10000</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;睡眠完毕...&#34;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;发生中断异常...&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;run 方法执行完毕...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">进入睡眠状态</span><span class="o">...</span>
<span class="n">发生中断异常</span><span class="o">...</span>
<span class="n">run</span> <span class="n">方法执行完毕</span><span class="o">...</span>
</code></pre></td></tr></table>
</div>
</div><p>通过结果可以看出，当调用<code>thread.start();</code>以后，线程 thread 便进入了睡眠状态，然后开始睡眠 10 秒，而等到 2 秒之后便执行了<code>thread.interrupt();</code>中断操作。由于发生了中断，被 catch 捕获到了异常，最后 run 方法相继执行完毕。</p>
<p>下面通过一个示例，来看一看 interrupt() 方法是否可以中断处于<strong>非阻塞状态</strong>的线程：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InterruptMethodInThreadNoBlockingTest</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">InterruptThreadNoBlocking</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InterruptThreadNoBlocking</span><span class="o">();</span>
        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="n">thread1</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">InterruptThreadNoBlocking</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">&#34; while 在循环...&#34;</span><span class="o">);</span>
            <span class="n">i</span><span class="o">++;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>程序的输出会一直运行，直到 i 超过 Integer.MAX_VALUE。因此，调用 interrupt() 方法不能中断处于<strong>非阻塞状态</strong>的线程，但由于调用 interrupt() 方法相当于将中断标志设置为 true，所以可以通过调用 isInterrupted() 或 interrupted() 来判断中断标志是否被置位，以此来中断线程的执行。</p>
<p>但一般情况下不会通过上述的方式进行设置，可以在 MyThread 类中增加一个 volatile 属性的 isStop 来标志是否结束 while 循环，然后在 while 循环中判断 isStop 的值，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="o">{</span>
        <span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isStop</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
            <span class="k">while</span><span class="o">(!</span><span class="n">isStop</span><span class="o">){</span>
                <span class="n">i</span><span class="o">++;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStop</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">stop</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">isStop</span> <span class="o">=</span> <span class="n">stop</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>通过调用<code>setStop()</code>方法可以将 isStop 设置为 true，表明我要停止 while 循环了，从而可以将 while 语句结束循环。</p>
<h2 id="其它方法">其它方法</h2>
<p>此外，还有一些已经废弃的方法，如 stop()、suspend()、resume() 等。</p>
<p>对于 stop() 方法来说，它是一个不安全的方法，调用 stop() 方法会将正在运行的线程转换为消亡状态。该方法会抛出一个 ThreadDeath 错误，如果线程持有某个对象锁的话，会完全释放锁，导致对象状态不一致。所以 stop() 方法基本是不会被用到的。</p>
<p>对于 suspend() 方法，字面意思是延迟、推迟，该方法可以暂停线程。而对于 resume() 方法，字面意思是重新开始、恢复，该方法可以恢复线程的执行。但这两个方法可能会造成死锁。</p>
<p><strong>还有一些操作线程常用的方法</strong>：</p>
<ul>
<li>currentThread()：返回代码段正在被哪个线程调用的信息；</li>
<li>isAlive()：判断调用该方法的线程是否处于活动状态；</li>
<li>getId()：获得线程的唯一标识；</li>
<li>getName() 和 setName()：得到或设置线程的名字；</li>
<li>getPriority() 和 setPriority()：获得或设置线程的优先级；</li>
<li>Daemon：Java 中的线程分为用户线程和守护线程，任何一个守护线程都是为整个 JVM 中所有非守护线程服务的，只要当前 JVM 实例中存在任何一个非守护线程没有结束，那么守护线程就在工作，只有当最后一个非守护线程结束的时候，守护线程才随着 JVM 一同结束工作。</li>
</ul>
<h1 id="参考">参考</h1>
<p><a href="https://blog.csdn.net/justloveyou_/article/details/54347954">https://blog.csdn.net/justloveyou_/article/details/54347954</a></p>
<p><a href="https://www.cnblogs.com/dolphin0520/p/3913517.html">https://www.cnblogs.com/dolphin0520/p/3913517.html</a></p>
<p><a href="https://www.cnblogs.com/dolphin0520/p/3920357.html">https://www.cnblogs.com/dolphin0520/p/3920357.html</a></p>
<p><a href="https://www.cnblogs.com/ITtangtang/p/7602363.html">https://www.cnblogs.com/ITtangtang/p/7602363.html</a></p>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Carol</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2020-03-18
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">Reward</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="https://i.loli.net/2019/11/17/zU4q6LiShYpHrdZ.png">
        <span>wechat</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="https://i.loli.net/2019/11/17/Xnlykx8W3f6DvFi.png">
        <span>alipay</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/Java/">Java</a>
          <a href="/tags/JDK/">JDK</a>
          <a href="/tags/Thread/">Thread</a>
          <a href="/tags/%E7%BA%BF%E7%A8%8B/">线程</a>
          <a href="/tags/%E8%BF%9B%E7%A8%8B/">进程</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/2020/03/20/Java-final-static/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Java 中的 final 和 static 关键字</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/2020/03/16/Java-volatile/">
            <span class="next-text nav-default">Java 中的 volatile</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'SirCarol';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/SirCarol_" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/dyfloveslife" class="iconfont icon-github" title="github"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Carol</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
