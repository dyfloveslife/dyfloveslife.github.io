<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>设计模式汇总 - Carol&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Carol" /><meta name="description" content="之前或多或少接触过几种设计模式，只不过没有好好的总结。本文用于记录自己在设计模式方面的学习过程，在学习期间阅读了有关设计模式的书籍，挑选了博客园中优秀的文章，搜集网上的资料并进行了筛选，也看过别人对设计模式的总结。只是单纯看的话，会容易忘记。因此，我一般喜欢“输出式学习”，将学过的知识与自己对知识的理解整理下来，构建一套属于自己的知识体系。即便以后忘记了，也会通过浏览对原有知识的总结，很快重新拾起这部分的知识。
" /><meta name="keywords" content="Java, blog, carol" />






<meta name="generator" content="Hugo 0.84.1 with theme even" />


<link rel="canonical" href="http://localhost:1313/2020/05/12/Design-Patterns/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<link href="/dist/even.a289a5a4.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="设计模式汇总" />
<meta property="og:description" content="之前或多或少接触过几种设计模式，只不过没有好好的总结。本文用于记录自己在设计模式方面的学习过程，在学习期间阅读了有关设计模式的书籍，挑选了博客园中优秀的文章，搜集网上的资料并进行了筛选，也看过别人对设计模式的总结。只是单纯看的话，会容易忘记。因此，我一般喜欢“输出式学习”，将学过的知识与自己对知识的理解整理下来，构建一套属于自己的知识体系。即便以后忘记了，也会通过浏览对原有知识的总结，很快重新拾起这部分的知识。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/2020/05/12/Design-Patterns/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-05-12T11:43:11&#43;08:00" />
<meta property="article:modified_time" content="2020-06-11T17:24:56&#43;08:00" />

<meta itemprop="name" content="设计模式汇总">
<meta itemprop="description" content="之前或多或少接触过几种设计模式，只不过没有好好的总结。本文用于记录自己在设计模式方面的学习过程，在学习期间阅读了有关设计模式的书籍，挑选了博客园中优秀的文章，搜集网上的资料并进行了筛选，也看过别人对设计模式的总结。只是单纯看的话，会容易忘记。因此，我一般喜欢“输出式学习”，将学过的知识与自己对知识的理解整理下来，构建一套属于自己的知识体系。即便以后忘记了，也会通过浏览对原有知识的总结，很快重新拾起这部分的知识。"><meta itemprop="datePublished" content="2020-05-12T11:43:11&#43;08:00" />
<meta itemprop="dateModified" content="2020-06-11T17:24:56&#43;08:00" />
<meta itemprop="wordCount" content="24419">
<meta itemprop="keywords" content="Java,Desgin Patterns," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="设计模式汇总"/>
<meta name="twitter:description" content="之前或多或少接触过几种设计模式，只不过没有好好的总结。本文用于记录自己在设计模式方面的学习过程，在学习期间阅读了有关设计模式的书籍，挑选了博客园中优秀的文章，搜集网上的资料并进行了筛选，也看过别人对设计模式的总结。只是单纯看的话，会容易忘记。因此，我一般喜欢“输出式学习”，将学过的知识与自己对知识的理解整理下来，构建一套属于自己的知识体系。即便以后忘记了，也会通过浏览对原有知识的总结，很快重新拾起这部分的知识。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Carol&#39;s blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Carol&#39;s blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">设计模式汇总</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-05-12 </span>
        <div class="post-category">
            <a href="/categories/Java/"> Java </a>
            </div>
          <span class="more-meta"> 24419 words </span>
          <span class="more-meta"> 49 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#单一职责原则">单一职责原则</a></li>
    <li><a href="#里氏替换原则">里氏替换原则</a></li>
    <li><a href="#依赖倒置原则">依赖倒置原则</a></li>
    <li><a href="#接口隔离原则">接口隔离原则</a></li>
    <li><a href="#迪米特法则">迪米特法则</a></li>
    <li><a href="#开闭原则">开闭原则</a></li>
  </ul>

  <ul>
    <li><a href="#单例模式">单例模式</a></li>
    <li><a href="#工厂方法模式">工厂方法模式</a></li>
    <li><a href="#抽象工厂模式">抽象工厂模式</a></li>
    <li><a href="#建造者模式">建造者模式</a></li>
    <li><a href="#原型模式">原型模式</a></li>
  </ul>

  <ul>
    <li><a href="#代理模式">代理模式</a>
      <ul>
        <li><a href="#静态代理">静态代理</a></li>
        <li><a href="#动态代理">动态代理</a></li>
        <li><a href="#cglib-代理">CGlib 代理</a></li>
      </ul>
    </li>
    <li><a href="#适配器模式">适配器模式</a>
      <ul>
        <li><a href="#类适配器模式">类适配器模式</a></li>
        <li><a href="#对象适配器模式">对象适配器模式</a></li>
        <li><a href="#接口适配器模式">接口适配器模式</a></li>
        <li><a href="#小结">小结</a></li>
      </ul>
    </li>
    <li><a href="#桥接模式">桥接模式</a></li>
    <li><a href="#装饰模式">装饰模式</a></li>
    <li><a href="#组合模式">组合模式</a></li>
    <li><a href="#外观模式">外观模式</a></li>
    <li><a href="#享元模式">享元模式</a></li>
  </ul>

  <ul>
    <li><a href="#模板方法模式">模板方法模式</a></li>
    <li><a href="#责任链模式">责任链模式</a></li>
    <li><a href="#策略模式">策略模式</a></li>
    <li><a href="#迭代器模式">迭代器模式</a></li>
    <li><a href="#观察者模式">观察者模式</a></li>
    <li><a href="#状态模式">状态模式</a></li>
    <li><a href="#命令模式">命令模式</a></li>
    <li><a href="#中介者模式">中介者模式</a></li>
    <li><a href="#备忘录模式">备忘录模式</a></li>
    <li><a href="#解释器模式">解释器模式</a></li>
    <li><a href="#访问者模式">访问者模式</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>之前或多或少接触过几种设计模式，只不过没有好好的总结。本文用于记录自己在设计模式方面的学习过程，在学习期间阅读了有关设计模式的书籍，挑选了博客园中优秀的文章，搜集网上的资料并进行了筛选，也看过别人对设计模式的总结。只是单纯看的话，会容易忘记。因此，我一般喜欢“输出式学习”，将学过的知识与自己对知识的理解整理下来，构建一套属于自己的知识体系。即便以后忘记了，也会通过浏览对原有知识的总结，很快重新拾起这部分的知识。</p>
<h1 id="概述">概述</h1>
<p>“前人栽树，后人乘凉”，下图罗列出了与设计模式相关的所有内容，包括<code>设计原则</code>、<code>创建型模式</code>、<code>构建型模式</code>以及<code>结构型模式</code>这四个部分。其中，<code>设计原则</code>是设计模式的基础，是程序员在编码时应遵守的原则，它解释了设计模式为什么要这么设计，同时也是设计模式的依据；而<code>后三个部分</code>是对设计模式的分类，根据不同的设计模式所实现的方式、呈现的不同特点、执行的不同行为所划分出不同的类别。</p>
<blockquote>
<p>红色内容表示常用设计模式。</p>
</blockquote>
<ul>
<li>设计原则
<ul>
<li>单一职责原则</li>
<li>里氏替换原则</li>
<li>依赖倒置原则</li>
<li>接口隔离原则</li>
<li>迪米特法则</li>
<li>开闭原则</li>
</ul>
</li>
<li>创建型的设计模式
<ul>
<li><!-- raw HTML omitted -->单例模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->工厂方法模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->抽象工厂模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->建造者模式<!-- raw HTML omitted --></li>
<li>原型模式</li>
</ul>
</li>
<li>结构型的设计模式
<ul>
<li><!-- raw HTML omitted -->代理模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->适配器模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->桥接模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->装饰模式<!-- raw HTML omitted --></li>
<li>组合模式</li>
<li>外观模式</li>
<li>享元模式</li>
</ul>
</li>
<li>行为型的设计模式
<ul>
<li><!-- raw HTML omitted -->模板方法模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->责任链模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->策略模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->迭代器模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->观察者模式<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->状态模式<!-- raw HTML omitted --></li>
<li>命令模式</li>
<li>中介者模式</li>
<li>备忘录模式</li>
<li>解释器模式</li>
<li>访问者模式</li>
</ul>
</li>
</ul>
<blockquote>
<p>图片大小约为 4.6M，由于网络原因可能会出现加载过慢的情况，请耐心等待。</p>
</blockquote>
<!-- raw HTML omitted -->
<p>下面分别对以上内容进行展开。</p>
<h1 id="设计原则">设计原则</h1>
<h2 id="单一职责原则">单一职责原则</h2>
<p>从字面意思上看，<code>单一职责原则（Single Responsibility Principle，SRP）</code>就是对于接口、方法、类来说，必须保证只有一个引起它变化的原因，否则类应该被拆分。如果一个类有一个以上的职责，这些职责就耦合在一起了，这就不满足单一职责的设计，这就会造成当一个职责发生变化的时候，可能会影响其它职责。此外，多个职责耦合在一起会影响其复用性。</p>
<p>基于以上的说明，你可以看到<code>单一职责原则</code>其实又称为<code>单一功能原则</code>，其核心就是控制类的粒度大小、将对象解耦、提高其内聚性。你可以想象一下，一个类只负责一项职责，其逻辑肯定要比负责多项职责简单得多。此外，单一职责原则也适用于方法，一个方法应该尽可能做好一件事情，如果一个方法处理的事情太多，那么其粒度就会变得很粗，不利于重用。</p>
<p>看下一个不满足单一职责原则的例子，首先声明了一个交通工具类 Vehicle，其中的 run() 方法接收不同类型的交通工具，而在主函数中创建了三个不同的对象，它们都使用了同一个 run() 方法，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_01_1_SingleResponsibilityPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Vehicle</span> <span class="n">vehicle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vehicle</span><span class="o">();</span>
        <span class="n">vehicle</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="s">&#34;汽车&#34;</span><span class="o">);</span>
        <span class="n">vehicle</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="s">&#34;飞机&#34;</span><span class="o">);</span>
        <span class="n">vehicle</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="s">&#34;潜艇&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Vehicle</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span> <span class="o">(</span><span class="n">String</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">vehicle</span> <span class="o">+</span> <span class="s">&#34; 在公路上运行...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">汽车</span> <span class="n">在公路上运行</span><span class="o">...</span>
<span class="n">飞机</span> <span class="n">在公路上运行</span><span class="o">...</span>
<span class="n">潜艇</span> <span class="n">在公路上运行</span><span class="o">...</span>
</code></pre></td></tr></table>
</div>
</div><p>从结果可以看到，<code>飞机 在公路上运行...</code>以及<code>潜艇 在公路上运行...</code>这显然是不合适的，这是因为它们都使用了 Vehicle 中的 run() 方法，这里了违反了<code>单一职责原则</code>。解决方法也很简单，可以根据交通工具运行方式的不同，分解成不同的类即可。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_01_2_SingleResponsibilityPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">RoadVehicle</span> <span class="n">roadVehicle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RoadVehicle</span><span class="o">();</span>
        <span class="n">roadVehicle</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="s">&#34;汽车&#34;</span><span class="o">);</span>

        <span class="n">AirVehicle</span> <span class="n">airVehicle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AirVehicle</span><span class="o">();</span>
        <span class="n">airVehicle</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="s">&#34;飞机&#34;</span><span class="o">);</span>

        <span class="n">WaterVehicle</span> <span class="n">waterVehicle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WaterVehicle</span><span class="o">();</span>
        <span class="n">waterVehicle</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="s">&#34;潜艇&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">RoadVehicle</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">String</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">vehicle</span> <span class="o">+</span> <span class="s">&#34; 在路上跑...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">AirVehicle</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span> <span class="o">(</span><span class="n">String</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">vehicle</span> <span class="o">+</span> <span class="s">&#34; 在空中飞...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">WaterVehicle</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span> <span class="o">(</span><span class="n">String</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">vehicle</span> <span class="o">+</span> <span class="s">&#34; 在水里游...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">汽车 在路上跑...
飞机 在空中飞...
潜艇 在水里游...
</code></pre></td></tr></table>
</div>
</div><p>可以看到，以上的方式是可以满足<code>单一职责原则的</code>，即每个类都做自己分内的事。但需要注意的是，以上的方式在修改的过程中，它的改动是很大的，即将类进行了分解，又修改了客户端（例如 main 方法中创建对象的过程）。因此，还可以对第一种方法中的 Vehicle 类修改为以下的形式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_01_3_SingleResponsibilityPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Vehicle</span> <span class="n">vehicle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vehicle</span><span class="o">();</span>
        <span class="n">vehicle</span><span class="o">.</span><span class="na">runRoad</span><span class="o">(</span><span class="s">&#34;汽车&#34;</span><span class="o">);</span>
        <span class="n">vehicle</span><span class="o">.</span><span class="na">runAir</span><span class="o">(</span><span class="s">&#34;飞机&#34;</span><span class="o">);</span>
        <span class="n">vehicle</span><span class="o">.</span><span class="na">runWater</span><span class="o">(</span><span class="s">&#34;潜艇&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Vehicle</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">runRoad</span><span class="o">(</span><span class="n">String</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">vehicle</span> <span class="o">+</span> <span class="s">&#34; 在路上跑...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">runAir</span><span class="o">(</span><span class="n">String</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">vehicle</span> <span class="o">+</span> <span class="s">&#34; 在空中飞...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">runWater</span><span class="o">(</span><span class="n">String</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">vehicle</span> <span class="o">+</span> <span class="s">&#34; 在水里游...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">汽车</span> <span class="n">在路上跑</span><span class="o">...</span>
<span class="n">飞机</span> <span class="n">在空中飞</span><span class="o">...</span>
<span class="n">潜艇</span> <span class="n">在水里游</span><span class="o">...</span>
</code></pre></td></tr></table>
</div>
</div><p>可以看到，以上修改方式虽然也违背了<code>单一职责原则</code>，对原来的类做了修改，但只是增加了几个方法。从方法层面上看，它是符合<code>单一职责原则</code>的，因为没有改动原来方法中的代码，每个方法分别有自己的职责，完成自己的任务，不干涉其它方法的任务。</p>
<p>最后，需要注意的是：通常情况下，应当遵守<code>单一职责原则</code>，只有逻辑足够简单，才可以在代码级别违反单一职责原则（就像上述对类的修改那样，添加了几个方法）。只有类中方法数量足够少的时候，可以在方法级别保证<code>单一职责原则</code>。</p>
<h2 id="里氏替换原则">里氏替换原则</h2>
<p><code>里氏替换原则（Liskov Substitution Principle，LSP）</code>与继承相关，即在子类继承父类的时候，必须保证父类所拥有的性质在子类中仍然成立。也就是说，<strong>子类可以扩展父类的功能，但不能改变父类原有的功能，除了添加新的方法用于完成新功能之外，尽量不要重写父类中的方法</strong>。这是因为，当通过重写父类中的方法来完成新的功能时，这样写起来虽然简单，但是整个继承体系的可复用性会比较差，在使用多态特性的场景下十分明显。</p>
<p><code>里氏替换原则</code>事实上主要阐述了与继承有关的一些原则，即什么时候应该使用继承，怎么使用继承，使用继承的时候需要注意的地方。该原则反应了子类和父类之间的关系，是开闭原则的补充。</p>
<p>回顾继承的概念可以发现，继承在最初设计的时候，能够带来许多便利，但也带来了一些弊端。例如，使用继承会给程序带来侵入性，程序的可移植性降低，增加了对象之间的耦合性。耦合性体现在：如果一个类 A 都被其它类继承，那么当类 A 需要修改的时候，必须考虑到所有的子类，并且类 A 修改后，所有涉及到的子类中的功能都有可能发生故障。</p>
<p>因此，<code>里氏替换原则</code>告诉我们：我们在进行编码的时候应尽量做到高内聚、低耦合，而继承实际上让类与类之间的耦合性提高了，所以，可以在适当的情况下通过<code>聚合</code>、<code>组合</code>、<code>依赖</code>的方式来解决问题。</p>
<p>例如，类 C 继承了类 B，类 B 继承了类 A，那么我们可以让类 C 去继承类 A，将其中某些通用的方法更加抽象地在类 A 中实现，这样的话，类 C 和类 B 之间就没有耦合关系了。</p>
<p>请看以下示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_02_1_LiskovSubstitutionPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;3 - 1 = &#34;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="na">func1</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;8 - 2 = &#34;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="na">func1</span><span class="o">(</span><span class="n">8</span><span class="o">,</span> <span class="n">2</span><span class="o">));</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;==============&#34;</span><span class="o">);</span>

        <span class="n">B</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">B</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;3 - 1 = &#34;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="na">func1</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;8 - 2 = &#34;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="na">func1</span><span class="o">(</span><span class="n">8</span><span class="o">,</span> <span class="n">2</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;3 + 1 + 10 = &#34;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="na">func2</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">func1</span><span class="o">(</span><span class="kt">int</span> <span class="n">num1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="kd">extends</span> <span class="n">A</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">func1</span><span class="o">(</span><span class="kt">int</span> <span class="n">value1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value1</span> <span class="o">+</span> <span class="n">value2</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">func2</span><span class="o">(</span><span class="kt">int</span> <span class="n">value1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">func1</span><span class="o">(</span><span class="n">value1</span><span class="o">,</span> <span class="n">value2</span><span class="o">)</span> <span class="o">+</span> <span class="n">10</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">3</span> <span class="o">-</span> <span class="n">1</span> <span class="o">=</span> <span class="n">2</span>
<span class="n">8</span> <span class="o">-</span> <span class="n">2</span> <span class="o">=</span> <span class="n">6</span>
<span class="o">==============</span>
<span class="n">3</span> <span class="o">-</span> <span class="n">1</span> <span class="o">=</span> <span class="n">4</span>
<span class="n">8</span> <span class="o">-</span> <span class="n">2</span> <span class="o">=</span> <span class="n">10</span>
<span class="n">3</span> <span class="o">+</span> <span class="n">1</span> <span class="o">+</span> <span class="n">10</span> <span class="o">=</span> <span class="n">14</span>
</code></pre></td></tr></table>
</div>
</div><p>先不着急看运行结果，我们先看一下类 A 和类 B 所实现的功能。类 A 中的 func1() 方法用于返回两数之差，类 B 继承了类 A，但是由于需要在类 B 中新添加一个功能：即完成两数相加，然后再和 10 求和的功能。也就是说，类 B 无意间重写了类 A 中的 func1() 方法。</p>
<p>从结果中可以看出，分割线上面的输出结果是正确的，因为都是调用了类 A 中的 func1() 方法。而分割线下面的输出结果是错误的。我的本意是求出<code>3-1</code>和<code>8-2</code>的结果，而由于子类 B 进行了重写（我可能没注意到），其实执行的是求和逻辑，也就违背了我想要执行求差的逻辑。因此，以上代码违背了<code>里氏替换原则</code>。</p>
<p><strong>如何解决这种问题呢</strong>？</p>
<p>通过示例可以看出，原先运行正常的求差功能出现了错误，原因是类 B <strong>无意间</strong>重写了父类的方法。因此，可以让原来的父类和子类都继承一个更加通俗的基类，原有的继承关系去掉，采用依赖、聚合、组合等关系代替。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_02_2_LiskovSubstitutionPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;3 - 1 = &#34;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="na">func1</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;8 - 2 = &#34;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="na">func1</span><span class="o">(</span><span class="n">8</span><span class="o">,</span> <span class="n">2</span><span class="o">));</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;==============&#34;</span><span class="o">);</span>

        <span class="n">B</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">B</span><span class="o">();</span>
        <span class="c1">// 由于类 B 不再继承类 A，因此调用者就会很明确该函数完成的功能
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;3 + 1 = &#34;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="na">func1</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;8 + 2 = &#34;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="na">func1</span><span class="o">(</span><span class="n">8</span><span class="o">,</span> <span class="n">2</span><span class="o">));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;3 + 1 + 10 = &#34;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="na">func2</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">));</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;==============&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;3 - 1 = &#34;</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="na">func3</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="n">1</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Base</span> <span class="o">{</span>
    <span class="c1">// 把更加基础的方法和成员放到 Base 类中
</span><span class="c1"></span><span class="o">}</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="kd">extends</span> <span class="n">Base</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">func1</span><span class="o">(</span><span class="kt">int</span> <span class="n">num1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">num2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="kd">extends</span> <span class="n">Base</span> <span class="o">{</span>
    <span class="c1">// 使用到了组合关系
</span><span class="c1"></span>    <span class="kd">private</span> <span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">func1</span><span class="o">(</span><span class="kt">int</span> <span class="n">value1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value1</span> <span class="o">+</span> <span class="n">value2</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">func2</span><span class="o">(</span><span class="kt">int</span> <span class="n">value1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">func1</span><span class="o">(</span><span class="n">value1</span><span class="o">,</span> <span class="n">value2</span><span class="o">)</span> <span class="o">+</span> <span class="n">10</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 调用类 A 中的求差方法
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">func3</span><span class="o">(</span><span class="kt">int</span> <span class="n">value1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">func1</span><span class="o">(</span><span class="n">value1</span><span class="o">,</span> <span class="n">value2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">3 - 1 = 2
8 - 2 = 6
==============
3 + 1 = 4
8 + 2 = 10
3 + 1 + 10 = 14
==============
3 - 1 = 2
</code></pre></td></tr></table>
</div>
</div><p>可以看到，类 A 和类 B 都继承了基类 Base，现在类 A 中的 func1() 方法就很明确了，就是专门求差的方法。而类 B 中的方法也很明确，就是专门用来求和的方法。此外，如果类 B 想要用到类 A 中的方法，那么直接在类 B 中创建对象即可。并且，还可以使用类 A 中的 fun1() 方法，用于求两数之差。</p>
<p>通过以上的示例可以看到，<code>里氏替换原则</code>所说的就是子类可以扩展父类的功能，但不能改变父类原有的功能。</p>
<h2 id="依赖倒置原则">依赖倒置原则</h2>
<p><code>依赖倒置原则（Dependence Inversion Principe，DIP）</code>指高层模块不应该依赖低层模块，两者都应该以来其抽象。模块之间的依赖通过抽象发生，实现类之间不发生直接的依赖关系，其依赖关系是通过接口或抽象类产生的。</p>
<p><code>抽象</code>在这里指的是接口或者抽象类，<code>细节</code>指的是具体的实现类。因此，该原则指出抽象不应该依赖细节，而细节应该依赖抽象。换句话说，就是接口或者抽象类不应该依赖实现类，而实现类应该依赖接口或者抽象类。核心在于：要面向接口编程，而不是面向实现编程。</p>
<p>为什么这么说？这是因为在软件设计中，具体的细节具有多变性，而抽象层则相对稳定，因此以抽象为基础搭建起来的架构要比以细节为基础搭建起来的架构要稳定得多。使用接口或者抽象类的目的就是制定好规范和标准，而不去涉及任何具体的操作，而把展现细节的任务交给它们的实现类去完成。</p>
<p>看一下示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_03_1_DependenceInversionPrincipe</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
        <span class="n">person</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="k">new</span> <span class="n">Email</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Email</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getInfo</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;邮件信息：Hello...&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">receive</span><span class="o">(</span><span class="n">Email</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">email</span><span class="o">.</span><span class="na">getInfo</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">邮件信息：Hello...
</code></pre></td></tr></table>
</div>
</div><p>以上示例实现的功能是能够让 Person 类接收消息。实现起来很简单，但这里只实现了接收邮箱 Email 的消息，而如果我们想要实现让 Person 接收短信消息、微信消息的话，则需要新添加短信类或者微信类，同时 Person 类也需要增加对应的方法才可以。你可以看到 Person 类中的 receive() 方法和 Email 类耦合在了一起，不利于以后业务的扩展。那如何解决呢？</p>
<p>可以引入一个接口 IReceiver 表示接收者，让邮箱、微信、短信都各自实现该接口即可。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_03_2_DependenceInversionPrincipe</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
        <span class="n">person</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="k">new</span> <span class="n">Email</span><span class="o">());</span>
        <span class="n">person</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="k">new</span> <span class="n">WeChat</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">IReceiver</span> <span class="o">{</span>
    <span class="n">String</span> <span class="nf">getInfo</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Email</span> <span class="kd">implements</span> <span class="n">IReceiver</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getInfo</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;邮件信息：Hello...&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">WeChat</span> <span class="kd">implements</span> <span class="n">IReceiver</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getInfo</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;微信消息：Hi...&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="c1">// receive 依赖了接口 IReceiver
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">receive</span><span class="o">(</span><span class="n">IReceiver</span> <span class="n">receiver</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">receiver</span><span class="o">.</span><span class="na">getInfo</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">邮件信息：Hello...
微信消息：Hi...
</code></pre></td></tr></table>
</div>
</div><p>可以看到，在以上的示例中定义了一个接口 IReceiver，其中的 Email 和 WeChat 类都实现了该接口，并且都在自己的类中重写了自己的方法。Person 类中只依赖了接口 IReceiver，而没有依赖具体的实现类（如 Email）。</p>
<p>因此，<code>依赖倒置原则</code>的目的是<strong>通过面向接口编程的方式来降低类间的耦合性</strong>，在使用该原则的时候，应给每个类尽量提供接口或抽象类，或者两者都具备。</p>
<h2 id="接口隔离原则">接口隔离原则</h2>
<p><code>接口隔离原则（Interface Segregation Principle，ISP）</code>字面意思上理解是尽量将多个接口或者复杂的接口拆分成更小并且更具体的接口。要为每个类建立它们需要的专用接口，而不是试图去建立一个复杂而庞大的接口供所有依赖它的类去调用。</p>
<p>我自己的理解是这样的，比如说类 A 由于需要使用到接口 Ⅰ 的部分方法（注意不是全部的方法）而实现了该接口，但是类 A 不得不需要重写接口 Ⅰ 中的所有方法，但类 A 只是需要其中的几个方法而却重写了接口中的全部方法，这对于类 A 来说无异于显得有些臃肿。所以，可以将接口 Ⅰ 拆分成多个接口，例如先将类 A 需要的方法拆分出来，封装成一个接口，然后将接口 Ⅰ 剩下的接口再放到一起，供其它类使用。</p>
<p>看以下示例，该示例展示的是定义了一个接口，在该接口中一共含有 5 个方法，此外，类 A 通过该接口依赖了类 B，类 C 通过该接口依赖了类 D。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_04_1_InterfaceSegregationPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Interface1</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">method1</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">method2</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">method3</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">method4</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">method5</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="kd">implements</span> <span class="n">Interface1</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 B 中实现了 method1()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 B 中实现了 method2()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method3</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 B 中实现了 method3()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method4</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 B 中实现了 method4()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method5</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 B 中实现了 method5()...&#34;</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">D</span> <span class="kd">implements</span> <span class="n">Interface1</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 D 中实现了 method1()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 D 中实现了 method2()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method3</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 D 中实现了 method3()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method4</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 D 中实现了 method4()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method5</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 D 中实现了 method5()...&#34;</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 类 A 通过接口 Interface1 依赖了 B 类，但只使用了 method1()、method2()、method3() 三个方法
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence1</span><span class="o">(</span><span class="n">Interface1</span> <span class="n">interface1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">interface1</span><span class="o">.</span><span class="na">method1</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence2</span><span class="o">(</span><span class="n">Interface1</span> <span class="n">interface1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">interface1</span><span class="o">.</span><span class="na">method2</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence3</span><span class="o">(</span><span class="n">Interface1</span> <span class="n">interface1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">interface1</span><span class="o">.</span><span class="na">method3</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 类 C 通过接口 Interface1 依赖了 D 类，但只使用了 method1()、method4()、method5()三个方法
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">C</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence1</span><span class="o">(</span><span class="n">Interface1</span> <span class="n">interface1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">interface1</span><span class="o">.</span><span class="na">method1</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence4</span><span class="o">(</span><span class="n">Interface1</span> <span class="n">interface1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">interface1</span><span class="o">.</span><span class="na">method4</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence5</span><span class="o">(</span><span class="n">Interface1</span> <span class="n">interface1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">interface1</span><span class="o">.</span><span class="na">method5</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>你可以看到，类 B 和类 D 都实现了接口 Interface1 中的方法，但是类 A 只用到了其中的三个方法，类 C 也只用到了其中的是哪个方法。即使是用到了三个方法，就需要将全部的方法进行实现，这无异于显得有些累赘。因此，根据<code>接口隔离原则</code>可以将该接口拆分成独立的几个接口，让类 A 和类 C 分别与它们需要的接口建立依赖关系即可。接口的分解如下所示：</p>
<ul>
<li>Interface1：
<ul>
<li>method1()</li>
</ul>
</li>
<li>Interface2：
<ul>
<li>method2()</li>
<li>method3()</li>
</ul>
</li>
<li>Interface3：
<ul>
<li>method4()</li>
<li>method5()</li>
</ul>
</li>
</ul>
<p>如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_04_1_InterfaceSegregationPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="o">();</span>
        <span class="c1">// 类 A 通过接口依赖类 B
</span><span class="c1"></span>        <span class="n">a</span><span class="o">.</span><span class="na">dependence1</span><span class="o">(</span><span class="k">new</span> <span class="n">B</span><span class="o">());</span>
        <span class="n">a</span><span class="o">.</span><span class="na">dependence2</span><span class="o">(</span><span class="k">new</span> <span class="n">B</span><span class="o">());</span>
        <span class="n">a</span><span class="o">.</span><span class="na">dependence3</span><span class="o">(</span><span class="k">new</span> <span class="n">B</span><span class="o">());</span>

        <span class="n">C</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">C</span><span class="o">();</span>
        <span class="c1">// 类 C 通过接口依赖类 D
</span><span class="c1"></span>        <span class="n">c</span><span class="o">.</span><span class="na">dependence1</span><span class="o">(</span><span class="k">new</span> <span class="n">D</span><span class="o">());</span>
        <span class="n">c</span><span class="o">.</span><span class="na">dependence4</span><span class="o">(</span><span class="k">new</span> <span class="n">D</span><span class="o">());</span>
        <span class="n">c</span><span class="o">.</span><span class="na">dependence5</span><span class="o">(</span><span class="k">new</span> <span class="n">D</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Interface1</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">method1</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Interface2</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">method2</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">method3</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Interface3</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">method4</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">method5</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">B</span> <span class="kd">implements</span> <span class="n">Interface1</span><span class="o">,</span> <span class="n">Interface2</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 B 中实现了 method1()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 B 中实现了 method2()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method3</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 B 中实现了 method3()...&#34;</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">D</span> <span class="kd">implements</span> <span class="n">Interface1</span><span class="o">,</span> <span class="n">Interface3</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 D 中实现了 method1()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method4</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 D 中实现了 method4()...&#34;</span><span class="o">);</span> <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">method5</span><span class="o">()</span> <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;类 D 中实现了 method5()...&#34;</span><span class="o">);</span> <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 类 A 通过接口 Interface1、Interface2 依赖了 B 类，使用到了 method1()、method2()、method3() 三个方法
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence1</span><span class="o">(</span><span class="n">Interface1</span> <span class="n">interface1</span><span class="o">)</span> <span class="o">{</span> <span class="n">interface1</span><span class="o">.</span><span class="na">method1</span><span class="o">();</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence2</span><span class="o">(</span><span class="n">Interface2</span> <span class="n">interface2</span><span class="o">)</span> <span class="o">{</span> <span class="n">interface2</span><span class="o">.</span><span class="na">method2</span><span class="o">();</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence3</span><span class="o">(</span><span class="n">Interface2</span> <span class="n">interface2</span><span class="o">)</span> <span class="o">{</span> <span class="n">interface2</span><span class="o">.</span><span class="na">method3</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 类 C 通过接口 Interface1、Interface3 依赖了 D 类，使用到了 method1()、method4()、method5()三个方法
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">C</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence1</span><span class="o">(</span><span class="n">Interface1</span> <span class="n">interface1</span><span class="o">)</span> <span class="o">{</span> <span class="n">interface1</span><span class="o">.</span><span class="na">method1</span><span class="o">();</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence4</span><span class="o">(</span><span class="n">Interface3</span> <span class="n">interface3</span><span class="o">)</span> <span class="o">{</span> <span class="n">interface3</span><span class="o">.</span><span class="na">method4</span><span class="o">();</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dependence5</span><span class="o">(</span><span class="n">Interface3</span> <span class="n">interface3</span><span class="o">)</span> <span class="o">{</span> <span class="n">interface3</span><span class="o">.</span><span class="na">method5</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">类</span> <span class="n">B</span> <span class="n">中实现了</span> <span class="nf">method1</span><span class="o">()...</span>
<span class="n">类</span> <span class="n">B</span> <span class="n">中实现了</span> <span class="nf">method2</span><span class="o">()...</span>
<span class="n">类</span> <span class="n">B</span> <span class="n">中实现了</span> <span class="nf">method3</span><span class="o">()...</span>
<span class="n">类</span> <span class="n">D</span> <span class="n">中实现了</span> <span class="nf">method1</span><span class="o">()...</span>
<span class="n">类</span> <span class="n">D</span> <span class="n">中实现了</span> <span class="nf">method4</span><span class="o">()...</span>
<span class="n">类</span> <span class="n">D</span> <span class="n">中实现了</span> <span class="nf">method5</span><span class="o">()...</span>
</code></pre></td></tr></table>
</div>
</div><p>通过改进可以看出，这里对之前的接口进行了改进，将其分解成多个接口，尽量做到接口的细化，接口中的方法尽量少，为每个类设计专用的接口。</p>
<p><code>接口隔离原则</code>与之前的<code>单一职责原则</code>都是为了提高类的内聚性、降低它们之间的耦合性，都体现了封装的思想，不同点在于：</p>
<ul>
<li>前者注重对<code>接口</code>的依赖隔离，后者注重的是<code>职责</code>；</li>
<li>前者主要对<code>接口</code>进行约束，针对抽象和程序整体框架的构建，后者主要对<code>类</code>进行约束，针对的是程序中的实现和细节。</li>
</ul>
<h2 id="迪米特法则">迪米特法则</h2>
<p><code>迪米特法则（Law of Demeter，LoD）</code>又称最少知道原则，指的是一个对象应该对其它对象保持最少的了解。也就是说，一个类对自己所依赖的类知道的越少越好。例如，类 A 依赖了类 B，那么对于被依赖的类 B 来说，不管它的内部再怎么复杂，都尽量将其逻辑封装在类的内部，除了对外提供公共的 public 方法以外，不对外泄漏任何信息。</p>
<p>可以将以上的内容概括为：<strong>只与直接朋友通信</strong>。这里的<code>直接朋友</code>指的是：一般情况下，每个对象都会与其它对象建立耦合关系（例如，依赖、关联、组合、聚合），只要两个对象之间存在耦合关系，就称这两个对象之间是朋友关系。这里将成员变量、方法参数、方法返回值中的类称为直接朋友，而出现在局部变量中的类不是直接朋友。因此，对于那些陌生的类来说，最好不要以局部变量的形式出现在类的内部。</p>
<p>下面看一个违反<code>迪米特法则</code>的示例，该示例表示的是有一个学校，其下属部门有各个学院以及学校的总部，现要求打印出学校总部员工的 ID 和学院员工的 ID。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_05_1_LawOfDemeter</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SchoolManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SchoolManager</span><span class="o">();</span>
        <span class="n">manager</span><span class="o">.</span><span class="na">printAllEmployee</span><span class="o">(</span><span class="k">new</span> <span class="n">CollegeManager</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 学校总部的员工类
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 学院的员工类
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">CollegeEmployee</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 用于管理学院员工的类
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">CollegeManager</span> <span class="o">{</span>
    <span class="c1">// 返回学院所有的员工 id
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">CollegeEmployee</span><span class="o">&gt;</span> <span class="nf">getAllEmployee</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">CollegeEmployee</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">CollegeEmployee</span> <span class="n">emp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CollegeEmployee</span><span class="o">();</span>
            <span class="n">emp</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">&#34;学院员工 id = &#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">emp</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 用于管理学校的类
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">SchoolManager</span> <span class="o">{</span>
    <span class="c1">// 返回学校总部的所有员工的 id
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="nf">getAllEmployee</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Employee</span> <span class="n">emp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">();</span>
            <span class="n">emp</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">&#34;学校总部员工 id = &#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">emp</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 用于输出学院员工 id 和学校总部员工 id
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printAllEmployee</span><span class="o">(</span><span class="n">CollegeManager</span> <span class="n">manager</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// CollegeEmployee 属于局部变量，
</span><span class="c1"></span>        <span class="c1">// 因此违反了迪米特法则
</span><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">CollegeEmployee</span><span class="o">&gt;</span> <span class="n">list1</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="na">getAllEmployee</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;========学院员工 id ========&#34;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">CollegeEmployee</span> <span class="n">e</span> <span class="o">:</span> <span class="n">list1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">list2</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getAllEmployee</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;========学校总部员工 id ========&#34;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Employee</span> <span class="n">e</span> <span class="o">:</span> <span class="n">list2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">========学院员工 id ========
学院员工 id = 0
学院员工 id = 1
学院员工 id = 2
学院员工 id = 3
学院员工 id = 4
学院员工 id = 5
学院员工 id = 6
学院员工 id = 7
学院员工 id = 8
学院员工 id = 9
========学校总部员工 id ========
学校总部员工 id = 0
学校总部员工 id = 1
学校总部员工 id = 2
学校总部员工 id = 3
学校总部员工 id = 4
</code></pre></td></tr></table>
</div>
</div><p>main 函数中首先创建了一个 SchoolManager 对象，然后调用了其 printAllEmployee() 方法用于输出学院员工的 id 以及学校总部员工的 id。</p>
<p>这里以 SchoolManager 类为例，分析其直接朋友有哪些。由于 Employee 属于方法的返回值，因此属于 SchoolManager 类的直接朋友。然后 CollegeManager 也属于 SchoolManager 类的直接朋友，因为它位于方法的参数上。但需要注意的是，CollegeEmployee 不是直接朋友，因为它不属于 SchoolManager 类的成员变量，也不属于方法参数，更不属于方法的返回值。因此，CollegeEmployee 违反了<code>迪米特法则</code>。那么如何改进呢？</p>
<p>之前说到：**类 A 依赖了类 B，那么对于被依赖的类 B 来说，不管它的内部再怎么复杂，都尽量将其逻辑封装在类的内部，除了对外提供公共的 public 方法以外，不对外泄漏任何信息。**因此，我们可以将 printAllEmployee() 方法中获取学院员工 id 的部分代码封装到 CollegeManager 类中，然后在 printAllEmployee() 方法中调用即可。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">CollegeManager</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">CollegeEmployee</span><span class="o">&gt;</span> <span class="nf">getAllEmployee</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">CollegeEmployee</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">CollegeEmployee</span> <span class="n">emp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CollegeEmployee</span><span class="o">();</span>
            <span class="n">emp</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">&#34;学院员工 id = &#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">emp</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 新添加的方法
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printEmployee</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">CollegeEmployee</span><span class="o">&gt;</span> <span class="n">list1</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getAllEmployee</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;========学院员工 id ========&#34;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">CollegeEmployee</span> <span class="n">e</span> <span class="o">:</span> <span class="n">list1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">SchoolManager</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="nf">getAllEmployee</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Employee</span> <span class="n">emp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">();</span>
            <span class="n">emp</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">&#34;学校总部员工 id = &#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">emp</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printAllEmployee</span><span class="o">(</span><span class="n">CollegeManager</span> <span class="n">manager</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 直接调用即可
</span><span class="c1"></span>        <span class="n">manager</span><span class="o">.</span><span class="na">printEmployee</span><span class="o">();</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">list2</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getAllEmployee</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;========学校总部员工 id ========&#34;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Employee</span> <span class="n">e</span> <span class="o">:</span> <span class="n">list2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这里将输出<code>学院员工 id</code>的代码封装到了 printEmployee() 方法中，并且该方法是 public 的，可以对外使用。因此，在 printAllEmployee() 方法中直接调用了 printEmployee() 方法，此时便符合了<code>迪米特法则</code>。</p>
<p>该法则强调的是降低类与类之间的耦合性，但需要注意的是，由于每个类都减少了不必要的依赖，因此<code>迪米特法则</code>只是要求降低类间耦合，并不是要求完全没有依赖关系。</p>
<h2 id="开闭原则">开闭原则</h2>
<p><code>开闭原则（Open Closed Principle，OCP）</code>一句话总结：<strong>对扩展开放，对修改关闭</strong>。这里所操作的实体可以是项目中的模块，或者类、接口、方法。由于可以扩展模块的功能，因此该原则可以提高软件的可复用性以及可维护性。</p>
<p>**用抽象构建框架，用实现扩展细节。**这是开闭原则的实现方式。因为抽象灵活性好，适应性广，只要抽象的合理，可以基本保持软件架构的稳定。而软件中容易变化的细节可以通过具体的实现类进行扩展。也就是说，当软件需要变化的时候，尽量通过扩展软件实体的方式来实现变化，而不是通过修改已有的代码来实现变化。</p>
<p>看如下示例，该示例通过创建不同的对象，输出不同的绘制图形的形状。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_06_1_OpenClosedPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">GraphicEditor</span> <span class="n">editor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GraphicEditor</span><span class="o">();</span>
        <span class="n">editor</span><span class="o">.</span><span class="na">drawShape</span><span class="o">(</span><span class="k">new</span> <span class="n">Rectangle</span><span class="o">());</span>
        <span class="n">editor</span><span class="o">.</span><span class="na">drawShape</span><span class="o">(</span><span class="k">new</span> <span class="n">Circle</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">GraphicEditor</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">drawShape</span><span class="o">(</span><span class="n">Shape</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">type</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">drawRectangle</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">type</span> <span class="o">==</span> <span class="n">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">drawCircle</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">drawRectangle</span><span class="o">(</span><span class="n">Shape</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;绘制矩形&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">drawCircle</span><span class="o">(</span><span class="n">Shape</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;绘制圆形&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Shape</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">type</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Rectangle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
    <span class="n">Rectangle</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
    <span class="n">Circle</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">2</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">绘制矩形
绘制圆形
</code></pre></td></tr></table>
</div>
</div><p>在 main 函数中，通过 GraphicEditor 的 drawShape() 接收不同的对象，根据每个对象中的 type 来判断其调用的具体方法。这种实现方式比较简单，易于理解。但如果想要再扩展新的功能的话，那么修改的地方就比较多了。例如，想要新添加一个图形的种类，将会进行如下修改：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_06_1_OpenClosedPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">GraphicEditor</span> <span class="n">editor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GraphicEditor</span><span class="o">();</span>
        <span class="n">editor</span><span class="o">.</span><span class="na">drawShape</span><span class="o">(</span><span class="k">new</span> <span class="n">Rectangle</span><span class="o">());</span>
        <span class="n">editor</span><span class="o">.</span><span class="na">drawShape</span><span class="o">(</span><span class="k">new</span> <span class="n">Circle</span><span class="o">());</span>

        <span class="c1">// 绘制三角形
</span><span class="c1"></span>        <span class="n">editor</span><span class="o">.</span><span class="na">drawShape</span><span class="o">(</span><span class="k">new</span> <span class="n">Triangle</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">GraphicEditor</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">drawShape</span><span class="o">(</span><span class="n">Shape</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">type</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">drawRectangle</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">type</span> <span class="o">==</span> <span class="n">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">drawCircle</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
            <span class="c1">// 这里增加了判断
</span><span class="c1"></span>        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">type</span> <span class="o">==</span> <span class="n">3</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">drawTriangle</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">drawRectangle</span><span class="o">(</span><span class="n">Shape</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;绘制矩形&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">drawCircle</span><span class="o">(</span><span class="n">Shape</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;绘制圆形&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// 这里增加了方法
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">drawTriangle</span> <span class="o">(</span><span class="n">Shape</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;绘制三角形&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Shape</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">type</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Rectangle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
    <span class="n">Rectangle</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
    <span class="n">Circle</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">2</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 这里增加了新的类
</span><span class="c1"></span><span class="kd">class</span> <span class="nc">Triangle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
    <span class="n">Triangle</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">3</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">绘制矩形
绘制圆形
绘制三角形
</code></pre></td></tr></table>
</div>
</div><p>上面的修改就违反了<code>开闭原则</code>，那么如何解决呢？这里可以通过将 Shape 类构建成抽象类，然后提供一个抽象的 draw() 方法，让子类去实现该方法即可。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">_06_1_OpenClosedPrinciple</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">GraphicEditor</span> <span class="n">editor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GraphicEditor</span><span class="o">();</span>
        <span class="n">editor</span><span class="o">.</span><span class="na">drawShape</span><span class="o">(</span><span class="k">new</span> <span class="n">Rectangle</span><span class="o">());</span>
        <span class="n">editor</span><span class="o">.</span><span class="na">drawShape</span><span class="o">(</span><span class="k">new</span> <span class="n">Circle</span><span class="o">());</span>

        <span class="n">editor</span><span class="o">.</span><span class="na">drawShape</span><span class="o">(</span><span class="k">new</span> <span class="n">Triangle</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">GraphicEditor</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">drawShape</span><span class="o">(</span><span class="n">Shape</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 直接调用 draw() 方法
</span><span class="c1"></span>       <span class="n">s</span><span class="o">.</span><span class="na">draw</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 抽象类
</span><span class="c1"></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Shape</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">type</span><span class="o">;</span>

    <span class="c1">// 抽象方法
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Rectangle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
    <span class="n">Rectangle</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;绘制矩形&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
    <span class="n">Circle</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">2</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;绘制圆形&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Triangle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
    <span class="n">Triangle</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">3</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;绘制三角形&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果还是一样的，这里将 Shape 类用 abstract 修饰，然后提供了一个公共的抽象方法 draw()，在 GraphicEditor 类中直接调用了该方法。如果再次扩展功能的话，直接再新添加一个类即可，例如画五角星图形的类，让它继承 Shape 类，而 Shape 类是不用修改的。</p>
<h1 id="创建型模式5-种">创建型模式（5 种）</h1>
<p>创建型模式主要关注的是“如何创建对象”，即将对象的创建与使用进行分离，降低系统耦合度的同时无需关心对象的创建细节，对象的创建由相关的工厂来完成。</p>
<p>对于以下 5 种创建型模式，除了工厂方法模式属于<code>类创建型</code>，其它的方法全部属于<code>对象创建型</code>。</p>
<h2 id="单例模式">单例模式</h2>
<p><code>单例模式（Singleton）</code>在之前的文章中提到过，即 <a href="https://dyfloveslife.github.io/2020/02/17/Singleton-pattern-in-java/">《Java 单例模式[备忘]》</a>，其思想为：保证一个类只有一个实例，并提供一个访问该示例的全局访问点，也就是对外提供一个 public 方法即可。</p>
<p>通常情况下，普通类的构造函数是 public 的，外部类可通过 new 关键字来生成多个实例。但如果将类的构造函数设置为 private 的，则外部类就无法调用该构造函数，也就无法生成多个实例了。因此，如果想要满足<code>单例模式</code>，该类自身就需要定义一个静态私有实例，然后向外提供一个静态的共有（public）函数，用于创建或获取该静态私有的实例。</p>
<p>详细内容请见 <a href="https://dyfloveslife.github.io/2020/02/17/Singleton-pattern-in-java/">《Java 单例模式[备忘]》</a>一文。</p>
<h2 id="工厂方法模式">工厂方法模式</h2>
<p><code>工厂方法（FactoryMethod）模式</code>通过定义一个创建产品对象的工厂接口，将产品对象的实际创建工作推迟到具体子工厂类中完成。其中，被创建出来的东西称为<code>产品</code>，创建产品的东西称为<code>工厂</code>。如果要创建的产品不多，只需要一个工厂类就可以完成的话，这种称为<code>简单工厂模式</code>。</p>
<p>在介绍<code>简单工厂模式</code>之前，先通过以下示例展示在不使用设计模式的情况下，如何实现以下需求。在该示例中，我们的需求是要生产披萨，而成产披萨的环节有准备原材料（prepare）、烘焙（bake）、将披萨切开（cut）以及装盒（box）四个操作，其中可以生产 CheesePizza 和 GreekPizza 两种披萨。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// Pizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Pizza</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">back</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#34; backing...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">cut</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#34; cutting...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">box</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#34; boxing...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// GreekPizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreekPizza</span> <span class="kd">extends</span> <span class="n">Pizza</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;给 GreekPizza 准备原材料...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// CheesePizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CheesePizza</span> <span class="kd">extends</span> <span class="n">Pizza</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;给 CheessPizza 准备原材料...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// OrderPizza.java
</span><span class="c1">// 用于订购披萨
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderPizza</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">OrderPizza</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Pizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">orderType</span><span class="o">;</span>

        <span class="k">do</span> <span class="o">{</span>
            <span class="n">orderType</span> <span class="o">=</span> <span class="n">getType</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;greek&#34;</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GreekPizza</span><span class="o">();</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;GreekPizza&#34;</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;cheese&#34;</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CheesePizza</span><span class="o">();</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;CheesePizza&#34;</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">// 输出披萨的制作过程
</span><span class="c1"></span>            <span class="n">pizza</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
            <span class="n">pizza</span><span class="o">.</span><span class="na">back</span><span class="o">();</span>
            <span class="n">pizza</span><span class="o">.</span><span class="na">cut</span><span class="o">();</span>
            <span class="n">pizza</span><span class="o">.</span><span class="na">box</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;请输入披萨类型：&#34;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">str</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// PizzaStore.java
</span><span class="c1">// 相当于客户端，即用于发出订购披萨的订单
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PizzaStore</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">OrderPizza</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">请输入披萨类型：
greek
给 GreekPizza 准备原材料...
GreekPizza backing...
GreekPizza cutting...
GreekPizza boxing...
请输入披萨类型：
abc

Process finished with exit code 0
</code></pre></td></tr></table>
</div>
</div><p>以上代码流程为：</p>
<ul>
<li>首先定义了一个抽象的 Pizza 类，并声明了四个制作披萨的过程；</li>
<li>其次又定义了 CheesePizza 和 GreekPizza，都继承了 Pizza 类；然后定义了 OrderPizza 类，用于订购披萨，在该类中又根据输入不同的披萨类型进而创建不同的对象，但由于只声明了两种类型的披萨，如果输入的是其它类型的披萨，则会执行 break，即退出 while 循环；</li>
<li>最后定义了 PizzaStore 类用于发起订购披萨的订单。</li>
</ul>
<p><strong>会出现什么问题</strong>？</p>
<p>以上这种传统的方式虽然实现简单，但是违背了<code>开闭原则</code>。假如现在想要新增一个披萨的种类，例如新增<code>ChicagoPizza</code>，则需要新创建一个 ChicagoPizza 类，再继承 Pizza 类，并且还需要在 OrderPizza 类的构造函数中添加<code>else if</code>语句。这种方法显然没有按照“扩展开放，修改关闭”的原则进行设计。</p>
<p><strong>那么如何改进呢？</strong></p>
<p>可以把创建 Pizza 对象封装到一个类中，当新增披萨种类的时候，只需要修改该类就可以，其它在创建 Pizza 对象的地方就不需要修改了。因此，这种方式也被称为<code>简单工厂模式</code>。</p>
<p><code>简单工厂模式</code>属于工厂模式的一种，它由一个工厂对象来决定创建出哪一种产品类的实例。也就是定义了一个创建对象的类，由这个类来<strong>封装实例化对象的行为</strong>。该模式在大量的创建某种、某类或某批对象的时候较为常用。</p>
<p>原先<code>创建对象的行为</code>属于 OrderPizza 类中，现在可以创建一个<code>SimpleFactory</code>类，将该类和 OrderPizza 类进行关联，如果想要订购某种类型的披萨，那么直接让<code>SimpleFactory</code>类去处理就可以了，然后返回给用户。</p>
<p>使用<code>简单工厂模式</code>进行改进，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// SimpleFactory.java
</span><span class="c1">// 声明一个简单工厂
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleFactory</span> <span class="o">{</span>

    <span class="c1">// 根据 orderType 返回对应的 Pizza 对象
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">Pizza</span> <span class="nf">createPizza</span><span class="o">(</span><span class="n">String</span> <span class="n">orderType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Pizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;greek&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GreekPizza</span><span class="o">();</span>
            <span class="n">pizza</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;GreekPizza&#34;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;cheese&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CheesePizza</span><span class="o">();</span>
            <span class="n">pizza</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;CheesePizza&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">pizza</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// OrderPizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderPizza</span> <span class="o">{</span>
    <span class="n">SimpleFactory</span> <span class="n">simpleFactory</span><span class="o">;</span>
    <span class="n">Pizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">OrderPizza</span> <span class="o">(</span><span class="n">SimpleFactory</span> <span class="n">simpleFactory</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">setSimpleFactory</span><span class="o">(</span><span class="n">simpleFactory</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSimpleFactory</span><span class="o">(</span><span class="n">SimpleFactory</span> <span class="n">simpleFactory</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">simpleFactory</span> <span class="o">=</span> <span class="n">simpleFactory</span><span class="o">;</span>

        <span class="n">String</span> <span class="n">orderType</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
        <span class="k">do</span> <span class="o">{</span>
            <span class="n">orderType</span> <span class="o">=</span> <span class="n">getType</span><span class="o">();</span>
            <span class="c1">// 已经把创建对象的细节封装在了 createPizza 中
</span><span class="c1"></span>            <span class="n">pizza</span> <span class="o">=</span> <span class="n">simpleFactory</span><span class="o">.</span><span class="na">createPizza</span><span class="o">(</span><span class="n">orderType</span><span class="o">);</span>

            <span class="c1">// 披萨订购成功，输出相应信息
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">pizza</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">back</span><span class="o">();</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">cut</span><span class="o">();</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">box</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;订购失败...&#34;</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;请输入披萨类型：&#34;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">str</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// PizzaStore.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PizzaStore</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">OrderPizza</span><span class="o">(</span><span class="k">new</span> <span class="n">SimpleFactory</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">请输入披萨类型：
greek
给 GreekPizza 准备原材料...
GreekPizza backing...
GreekPizza cutting...
GreekPizza boxing...
请输入披萨类型：
12
订购失败...

Process finished with exit code 0
</code></pre></td></tr></table>
</div>
</div><p>这里通过 SimpleFactory 实现了一个简单工厂，然后将创建对象的逻辑封装在 createPizza() 方法中。将来如果新增了一种类型的披萨，那么直接修改 SimpleFactory 即可，这样实现更加灵活。需要提到的是，如果将 createPizza() 方法声明为 static，即静态的，则将以上的方法称为<code>静态简单工厂</code>。</p>
<p>但如果又有一个新的需求，即客户在点披萨的时候，可以点不同地区、不同口味的披萨。例如，北京的 GreekPizza、北京的 CheesePizza，上海的 GreekPizza、上海的 CheesePizza。</p>
<p>对于这种需求，也可以使用简单工厂模式，例如 BJPizzaSimpleFactory、SHPizzaSimpleFactory，但如果还有其它地区的披萨，则需要不断地进行创建。考虑到项目的规模，这种方式实现起来不易维护、不易扩展。</p>
<p>因此，可以使用<code>工厂方法模式</code>。即将披萨项目的实例化功能抽象成抽象方法，在不同的子类中进行实现。也就是说，<code>工厂方法模式</code>定义了一个创建对象的抽象方法，由子类决定要实例化的类，将对象的实例化推迟到子类中。</p>
<p>下面通过使用<code>工厂方法模式</code>来实现以上需求，在 OrderPizza 类中实现一个抽象的 createPizza() 方法，然后让 BJOrderPizza 和 SHOrderPizza 去继承 OrderPizza 类，然后在各自的子类中去实现不同地区口味的披萨。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// OrderPizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">OrderPizza</span> <span class="o">{</span>
    <span class="c1">// 该抽象方法由各个工厂子类自己实现
</span><span class="c1"></span>    <span class="kd">abstract</span> <span class="n">Pizza</span> <span class="nf">createPizza</span><span class="o">(</span><span class="n">String</span> <span class="n">orderType</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">OrderPizza</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Pizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">orderType</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
        <span class="k">do</span> <span class="o">{</span>
            <span class="n">orderType</span> <span class="o">=</span> <span class="n">getType</span><span class="o">();</span>
            <span class="c1">// 重要：根据不同的 orderType 实现不同类型或者口味的披萨
</span><span class="c1"></span>            <span class="n">pizza</span> <span class="o">=</span> <span class="n">createPizza</span><span class="o">(</span><span class="n">orderType</span><span class="o">);</span>
            <span class="n">pizza</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
            <span class="n">pizza</span><span class="o">.</span><span class="na">back</span><span class="o">();</span>
            <span class="n">pizza</span><span class="o">.</span><span class="na">cut</span><span class="o">();</span>
            <span class="n">pizza</span><span class="o">.</span><span class="na">box</span><span class="o">();</span>

        <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;请输入披萨类型：&#34;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">str</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// BJOrderPizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BJOrderPizza</span> <span class="kd">extends</span> <span class="n">OrderPizza</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="n">Pizza</span> <span class="nf">createPizza</span><span class="o">(</span><span class="n">String</span> <span class="n">orderType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Pizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;greek&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BJGreekPizza</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;cheese&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BJCheesePizza</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">pizza</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// SHOrderPizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SHOrderPizza</span> <span class="kd">extends</span> <span class="n">OrderPizza</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="n">Pizza</span> <span class="nf">createPizza</span><span class="o">(</span><span class="n">String</span> <span class="n">orderType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Pizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;greek&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SHGreekPizza</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;cheese&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SHCheesePizza</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">pizza</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// BJCheesePizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BJCheesePizza</span> <span class="kd">extends</span> <span class="n">Pizza</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setName</span><span class="o">(</span><span class="s">&#34;北京的 CheesePizza...&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;给 BJCheesePizza 准备原材料...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// BJGreekPizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BJGreekPizza</span> <span class="kd">extends</span> <span class="n">Pizza</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setName</span><span class="o">(</span><span class="s">&#34;北京的 GreekPizza...&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;给 BJGreekPizza 准备原材料...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// SHCheesePizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SHCheesePizza</span> <span class="kd">extends</span> <span class="n">Pizza</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setName</span><span class="o">(</span><span class="s">&#34;上海的 GreekPizza...&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;给 SHGreekPizza 准备原材料...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// SHGreekPizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SHGreekPizza</span> <span class="kd">extends</span> <span class="n">Pizza</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setName</span><span class="o">(</span><span class="s">&#34;上海的 GreekPizza...&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;给 SHGreekPizza 准备原材料...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// PizzaStore.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PizzaStore</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">BJOrderPizza</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">请输入披萨类型：
greek
给 BJGreekPizza 准备原材料...
北京的 GreekPizza... backing...
北京的 GreekPizza... cutting...
北京的 GreekPizza... boxing...
请输入披萨类型：
cheese
给 BJCheesePizza 准备原材料...
北京的 CheesePizza... backing...
北京的 CheesePizza... cutting...
北京的 CheesePizza... boxing...
</code></pre></td></tr></table>
</div>
</div><p>由于在主函数中创建的是<code>北京</code>地区的披萨，所以最终结果输出的都是与<code>北京</code>相关的。以上代码首先定义了一个抽象的 OrderPizza 类，里面有一个抽象的 createPizza() 方法，这个方法去交给子类 BJOrderPizza 和 SHOrderPizza 实现，它们返回的都是一个 Pizza 对象。</p>
<h2 id="抽象工厂模式">抽象工厂模式</h2>
<p>在<code>工厂方法模式</code>中的两个示例分别展示了<code>简单工厂模式</code>和<code>工厂方法模式</code>，此外还有一种是<code>抽象工厂模式</code>，该模式可以将前两种进行整合。<code>抽象工厂模式</code>定义了一个接口，可以看做是对<code>简单工厂模式</code>的进一步封装。</p>
<p>下面使用<code>抽象工厂模式</code>来对订购披萨的需求进行实现，各类之间的关系如下所示：</p>
<!-- raw HTML omitted -->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// AbsFactory.java
</span><span class="c1">// 抽象模式的接口层
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AbsFactory</span> <span class="o">{</span>

    <span class="c1">// 让工厂子类去具体实现
</span><span class="c1"></span>    <span class="n">Pizza</span> <span class="nf">createPizza</span><span class="o">(</span><span class="n">String</span> <span class="n">orderType</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// BJFactory.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BJFactory</span> <span class="kd">implements</span> <span class="n">AbsFactory</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Pizza</span> <span class="nf">createPizza</span><span class="o">(</span><span class="n">String</span> <span class="n">orderType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Pizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;greek&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BJGreekPizza</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;cheese&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BJCheesePizza</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">pizza</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// SHFactory.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SHFactory</span> <span class="kd">implements</span> <span class="n">AbsFactory</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Pizza</span> <span class="nf">createPizza</span><span class="o">(</span><span class="n">String</span> <span class="n">orderType</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Pizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;greek&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SHGreekPizza</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">orderType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;cheese&#34;</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SHCheesePizza</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">pizza</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// OrderPizza.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderPizza</span> <span class="o">{</span>

    <span class="n">AbsFactory</span> <span class="n">factory</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">OrderPizza</span> <span class="o">(</span><span class="n">AbsFactory</span> <span class="n">factory</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">setFactory</span><span class="o">(</span><span class="n">factory</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setFactory</span><span class="o">(</span><span class="n">AbsFactory</span> <span class="n">factory</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">factory</span> <span class="o">=</span> <span class="n">factory</span><span class="o">;</span>
        <span class="n">Pizza</span> <span class="n">pizza</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">orderType</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>

        <span class="k">do</span> <span class="o">{</span>
            <span class="n">orderType</span> <span class="o">=</span> <span class="n">getType</span><span class="o">();</span>
            <span class="n">pizza</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">createPizza</span><span class="o">(</span><span class="n">orderType</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">pizza</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">back</span><span class="o">();</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">cut</span><span class="o">();</span>
                <span class="n">pizza</span><span class="o">.</span><span class="na">box</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;订购失败...&#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">));</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;请输入披萨类型：&#34;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">str</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// PizzaStore.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PizzaStore</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">OrderPizza</span><span class="o">(</span><span class="k">new</span> <span class="n">BJFactory</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>最后的结果与之前是一样的，这里就不再展开了。</p>
<p>在 JDK 中，Calendar 类使用到了简单工厂模式。从以上三个示例可以看出，<code>抽象工厂模式</code>的这种<strong>依赖抽象</strong>的原则是：在创建对象实例的时候，不直接使用 new 创建对象，而是把创建对象的动作放在一个工厂的方法中，然后再返回。并且，这里也不是让类继承具体的类，而是继承抽象类或实现接口。</p>
<h2 id="建造者模式">建造者模式</h2>
<p><code>建造者（Builder）模式</code>创建的是<strong>复杂对象</strong>，将复杂对象的构造方式和它的表示方式进行分离，使同样的构建过程可以创建不同的表示。可以简单的将<strong>复杂对象</strong>理解为在创建对象 new XXX() 的时候，还需要设置许多属性，而相对应的<strong>简单对象</strong>就只需要在创建对象的时候通过 new XXX() 即可，不需要设置属性。</p>
<p>在创建复杂对象的时候，该对象通常由多个子部件按照一定的步骤组合而成，在没有组成之前，该对象不能作为一个完整的产品使用。例如电子邮件所包含的发件人、收件人、主题、内容等等。电子邮件由这么多的子部件组成，而最起码在收件人地址填写之前，该邮件是不能发送的，也即在产品没有组装完成之前是不能使用的。</p>
<p>因此，<strong>建造者模式</strong>可以将一个产品的内部表象与产品的生产过程分割开来，从而可以使一个建造过程生成具有不同的内部表象的产品对象。这里的<strong>内部表象</strong>是指：一个产品由不同的组成成分作为该产品的零件，我们把这些零件叫做产品的内部表象。不同的产品可以有不同的内部表象，也就是有不同的零件。使用<strong>建造者模式</strong>可以使客户端不需要知道所生产的产品有哪些零件，也不需要让客户端知道每个产品对应的零件彼此有何不同、怎么创建出来的、怎么组成的。</p>
<p>其实，它的核心思想就是：将<code>产品的创建过程</code>与<code>产品</code>进行解耦。也就是说，如果把<code>产品</code>和<code>产品的创建过程</code>封装在一起的话，就会增强它们之间的耦合性，不利于以后程序的扩展和维护。</p>
<p>下面通过使用传统的实现方式来完成<strong>建造房子</strong>的需求，我们可以将建造房子的过程分为打桩、砌墙、封顶。而可以创建的房子也有很多类型，如普通的房子、高楼大厦或者是别墅。这些房子的创建过程虽然一样，但是具体的要求是不同的。例如，对于打桩这一步骤来说，不同的房子所打桩的深度也是不同的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// AbstractHouse.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractHouse</span> <span class="o">{</span>
    <span class="c1">// 打桩
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">buildBasic</span><span class="o">();</span>

    <span class="c1">// 砌墙
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">buildWalls</span><span class="o">();</span>

    <span class="c1">// 封顶
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">roofed</span><span class="o">();</span>

    <span class="c1">// 盖房子
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">buildBasic</span><span class="o">();</span>
        <span class="n">buildWalls</span><span class="o">();</span>
        <span class="n">roofed</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 普通房子
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommonHouse</span> <span class="kd">extends</span> <span class="n">AbstractHouse</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildBasic</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;普通房子打桩...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildWalls</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;普通房子砌墙...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">roofed</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;普通房子封顶...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 高楼
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HighHouse</span> <span class="kd">extends</span> <span class="n">AbstractHouse</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildBasic</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;高楼打桩...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildWalls</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;高楼砌墙...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">roofed</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;高楼封顶...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 客户端
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">CommonHouse</span> <span class="n">commonHouse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommonHouse</span><span class="o">();</span>
        <span class="n">HighHouse</span> <span class="n">highHouse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HighHouse</span><span class="o">();</span>

        <span class="n">commonHouse</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="n">highHouse</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">普通房子打桩...
普通房子砌墙...
普通房子封顶...
高楼打桩...
高楼砌墙...
高楼封顶...
</code></pre></td></tr></table>
</div>
</div><p>对于以上的代码，首先定义了一个抽象类 AbstractHouse，该类是对房子的抽象，其中包括建造房子的步骤；然后定义了 HighHouse 和 CommonHouse 两个类，均继承了 AbstractHouse，并重写了里面的方法；最后定义了一个客户端 Client 来创建这两个房子。</p>
<p>这种传统的设计方式虽然便于理解，设计简单，但不利于程序的维护和扩展。例如，这种设计方式把产品（房子）和创建产品的过程（建造房子的流程）封装在了一起，增加了耦合性。因此，对于这种情况，可以通过<strong>建造者模式</strong>进行修改。</p>
<p>在修改之前，<strong>建造者模式</strong>还涉及到以下四种角色：</p>
<!-- raw HTML omitted -->
<ul>
<li><strong>产品（Product）角色</strong>：指一个具体的产品对象，也即建造中的复杂对象。一般来说，一个系统中会有一个以上的产品类，而这些产品类并不一定有共同的接口，完全可以是不相关联的。</li>
<li><strong>抽象建造者（Builder）角色</strong>：指创建一个 Product 对象的各个部件指定的接口（也可以是抽象类）。它主要用于给出一个抽象接口，用来规范产品对象的各个组成部分的建造。</li>
<li><strong>具体建造者（ConcreteBuilder）角色</strong>：该角色是与应用程序密切相关的一个类，它用于在应用程序的调用下创建产品的实例。也就是用于直接创建产品对象。该角色需要实现<code>抽象建造者角色</code>接口中的方法（如 buildPart1() 和 buildPart2() 方法），这些方法就是一步一步地完成创建产品实例的操作。并且在建造完成后，需要提供产品的实例（如 retrieveResult() 方法）。</li>
<li><strong>指挥者（Director）角色</strong>：构建一个使用 Builder 接口的对象以创建产品对象。该角色没有产品类的具体知识，真正拥有产品类的具体知识的是具体建造者角色。</li>
</ul>
<p>下面用<strong>建造者模式</strong>来重新设计建造房子的需求：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 产品
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">House</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">basic</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">wall</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">roofed</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getBasic</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">basic</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBasic</span><span class="o">(</span><span class="n">String</span> <span class="n">basic</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">basic</span> <span class="o">=</span> <span class="n">basic</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getWall</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">wall</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setWall</span><span class="o">(</span><span class="n">String</span> <span class="n">wall</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">wall</span> <span class="o">=</span> <span class="n">wall</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getRoofed</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roofed</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoofed</span><span class="o">(</span><span class="n">String</span> <span class="n">roofed</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roofed</span> <span class="o">=</span> <span class="n">roofed</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 抽象的建造者
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">HouseBuilder</span> <span class="o">{</span>

    <span class="n">House</span> <span class="n">house</span> <span class="o">=</span> <span class="k">new</span> <span class="n">House</span><span class="o">();</span>

    <span class="c1">// 打桩
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">buildBasic</span><span class="o">();</span>

    <span class="c1">// 砌墙
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">buildWalls</span><span class="o">();</span>

    <span class="c1">// 封顶
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">roofed</span><span class="o">();</span>

    <span class="c1">// 建造完房子以后，将产品（房子）返回
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">House</span> <span class="nf">buildHouse</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">house</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 普通房子
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommonHouse</span> <span class="kd">extends</span> <span class="n">HouseBuilder</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildBasic</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;普通房子打桩 5 米...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildWalls</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;普通房子砌墙 2 米...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">roofed</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;普通房子封顶 1 米...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 高楼
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HighHouse</span> <span class="kd">extends</span> <span class="n">HouseBuilder</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildBasic</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;高楼打桩 10 米...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildWalls</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;高楼砌墙 5 米...&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">roofed</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;高楼封顶 10 米...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 指挥者
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HouseDirector</span> <span class="o">{</span>

    <span class="n">HouseBuilder</span> <span class="n">houseBuilder</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">HouseDirector</span><span class="o">(</span><span class="n">HouseBuilder</span> <span class="n">houseBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">houseBuilder</span> <span class="o">=</span> <span class="n">houseBuilder</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHouseBuilder</span><span class="o">(</span><span class="n">HouseBuilder</span> <span class="n">houseBuilder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">houseBuilder</span> <span class="o">=</span> <span class="n">houseBuilder</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 如何建造房子的流程交给指挥者
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">House</span> <span class="nf">constructHouse</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">houseBuilder</span><span class="o">.</span><span class="na">buildBasic</span><span class="o">();</span>
        <span class="n">houseBuilder</span><span class="o">.</span><span class="na">buildWalls</span><span class="o">();</span>
        <span class="n">houseBuilder</span><span class="o">.</span><span class="na">roofed</span><span class="o">();</span>

        <span class="k">return</span> <span class="n">houseBuilder</span><span class="o">.</span><span class="na">buildHouse</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 客户端
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 现在想要建造普通的房子
</span><span class="c1"></span>        <span class="n">CommonHouse</span> <span class="n">commonHouse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommonHouse</span><span class="o">();</span>
        <span class="c1">// 准备建造房子的指挥者
</span><span class="c1"></span>        <span class="n">HouseDirector</span> <span class="n">houseDirector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HouseDirector</span><span class="o">(</span><span class="n">commonHouse</span><span class="o">);</span>
        <span class="c1">// 完成盖房子，返回产品（房子）
</span><span class="c1"></span>        <span class="n">houseDirector</span><span class="o">.</span><span class="na">constructHouse</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;=================&#34;</span><span class="o">);</span>

        <span class="n">HighHouse</span> <span class="n">highHouse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HighHouse</span><span class="o">();</span>
        <span class="n">houseDirector</span><span class="o">.</span><span class="na">setHouseBuilder</span><span class="o">(</span><span class="n">highHouse</span><span class="o">);</span>
        <span class="n">houseDirector</span><span class="o">.</span><span class="na">constructHouse</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">普通房子打桩</span> <span class="n">5</span> <span class="n">米</span><span class="o">...</span>
<span class="n">普通房子砌墙</span> <span class="n">2</span> <span class="n">米</span><span class="o">...</span>
<span class="n">普通房子封顶</span> <span class="n">1</span> <span class="n">米</span><span class="o">...</span>
<span class="o">=================</span>
<span class="n">高楼打桩</span> <span class="n">10</span> <span class="n">米</span><span class="o">...</span>
<span class="n">高楼砌墙</span> <span class="n">5</span> <span class="n">米</span><span class="o">...</span>
<span class="n">高楼封顶</span> <span class="n">10</span> <span class="n">米</span><span class="o">...</span>
</code></pre></td></tr></table>
</div>
</div><!-- raw HTML omitted -->
<p>通过 UML 图可以看出以上类之间的关系，具体要建造高楼还是普通的房子，可以通过<strong>具体建造者角色</strong>来指定（如 CommonHouse、HighHouse），而<strong>抽象的建造者角色</strong>（HouseBuilder）包含了建造房子的抽象方法，以及用于返回产品的方法。而指挥者（HouseDirector）是与客户端（Client）打交道的的角色。指挥者将客户端创建产品的请求划分为对各个零件的建造请求，再将这些请求委派给具体建造者角色。最后，具体建造者角色是做具体建造工作的，但是却不为客户端所知。</p>
<p>当然，在 JDK 的源码中，StringBuilder 也使用到了建造者模式。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">StringBuilder</span> <span class="kd">extends</span> <span class="n">AbstractStringBuilder</span>
                                <span class="kd">implements</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">Serializable</span><span class="o">,</span> <span class="n">CharSequence</span> <span class="o">{...}</span>

<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractStringBuilder</span> <span class="kd">implements</span> <span class="n">Appendable</span><span class="o">,</span> <span class="n">CharSequence</span> <span class="o">{...}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Appendable</span> <span class="o">{...}</span>
</code></pre></td></tr></table>
</div>
</div><p>StringBuilder 继承了 AbstractStringBuilder，而 AbstractStringBuilder 实现了 Appendable 接口。在 Appendable 接口中定义的方法都是抽象的。因此，这里的 Appendable 充当了<strong>抽象建造者角色</strong>。而 AbstractStringBuilder 类已经把 Appendable 接口中的方法实现了，因此 AbstractStringBuilder 类在这里充当的是<strong>具体建造者角色</strong>，只不过不能实例化，因为它是抽象的。最后，StringBuilder 充当了<strong>具体建造者角色</strong>，同时也充当了<strong>指挥者角色</strong>，建造方法的实现是由 AbstractStringBuilder 完成的，而 StringBuilder 继承了 AbstractStringBuilder。</p>
<p>可以看到，虽然 StringBuilder 的源码结构与建造者模式有些出入，但其实也是满足建造者模式的。最后再总结一下<code>建造者模式</code>的细节：</p>
<ul>
<li>客户端（应用程序）不需要知道产品的内部组成细节，通过将产品本身与产品的创建过程解耦，使得相同的创建过程可以创建不同的产品对象；</li>
<li>每一个<strong>具体创造者角色</strong>都是相对独立的，与其它<strong>具体创造者角色</strong>无关，用户使用不同的<strong>具体创造者角色</strong>可以得到不同的产品对象；</li>
<li>可以更加精细的控制产品的创建过程；</li>
<li>增加新的<strong>具体创造者角色</strong>无需修改原有类库的代码，而<strong>指挥者</strong>针对<strong>抽象建造者</strong>类进行编程。</li>
</ul>
<h2 id="原型模式">原型模式</h2>
<p>TODO</p>
<h1 id="结构型模式7-种">结构型模式（7 种）</h1>
<h2 id="代理模式">代理模式</h2>
<p><code>代理（proxy）模式</code>的核心思想是：为某个对象提供一种代理以控制对该对象的访问，即客户端通过代理<code>间接</code>访问该对象，从而限制、增强或修改对象的一些特性。因此，这里所说的<code>代理</code>被称为<code>代理对象</code>，相当于房屋中介。引入代理对象后，客户端不能直接访问目标对象，代理对象作为客户端和目标对象之间的中介，以“经纪人”的身份帮你完成某些任务。</p>
<p>被代理的对象可以是<!-- raw HTML omitted -->远程对象、创建开销很大的对象或需要安全控制的对象<!-- raw HTML omitted -->。当访问的远程对象比较大时，在访问的时候可能会非常耗时，因此可以找一个中介来帮忙完成这个任务；对于需要安全控制的对象，因为安全原因客户端不能直接访问真实的对象，因此也可以通过中介来帮忙访问。</p>
<p>引入代理对象后，代理对象位于客户端和目标对象的中间，可以起到保护目标对象的作用。另外，代理对象还可以扩展目标对象的功能。最后，代理对象将客户端和目标对象进行了分离，在一定程度上降低了系统的耦合度。以上是代理模式的优点，当然也有缺点。例如由于代理对象处于客户端和目标对象的中间，因此请求处理的过程可能会很慢，此外，有可能增加系统的复杂度。</p>
<p>具体的代理方式有<!-- raw HTML omitted -->静态代理、动态代理（JDK 代理）、CGlib 代理<!-- raw HTML omitted -->，其中 CGlib 代理可以在内存中动态的创建对象，而不需要实现接口。</p>
<h3 id="静态代理">静态代理</h3>
<p>静态代理在使用的时候需要注意的是：<!-- raw HTML omitted -->需要定义接口或父类，目标对象（被代理对象）与代理对象需要一起实现相同的接口或继承相同父类<!-- raw HTML omitted -->。</p>
<p>下面通过教师上课的示例，对静态代理进行展开。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 抽象对象角色，声明了目标对象和代理对象的共同接口
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ITeacherDAO</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">teach</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">/// 目标对象
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TeacherDAO</span> <span class="kd">implements</span> <span class="n">ITeacherDAO</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">teach</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;授课...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 代理对象
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TeacherDAOProxy</span> <span class="kd">implements</span> <span class="n">ITeacherDAO</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">ITeacherDAO</span> <span class="n">target</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">TeacherDAOProxy</span><span class="o">(</span><span class="n">ITeacherDAO</span> <span class="n">target</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">teach</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;开始代理...&#34;</span><span class="o">);</span>
        <span class="n">target</span><span class="o">.</span><span class="na">teach</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;代理结束...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 客户端
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 首先创建目标对象
</span><span class="c1"></span>        <span class="n">TeacherDAO</span> <span class="n">teacherDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TeacherDAO</span><span class="o">();</span>

        <span class="c1">// 然后创建代理对象，同时将目标对象传递给代理对象
</span><span class="c1"></span>        <span class="n">TeacherDAOProxy</span> <span class="n">teacherDAOProxy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TeacherDAOProxy</span><span class="o">(</span><span class="n">teacherDAO</span><span class="o">);</span>

        <span class="c1">// 通过代理对象，执行目标对象的方法
</span><span class="c1"></span>        <span class="c1">// 即执行的是代理对象的方法，代理对象再去调用目标对象的方法
</span><span class="c1"></span>        <span class="n">teacherDAOProxy</span><span class="o">.</span><span class="na">teach</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">开始代理...
授课...
代理结束...
</code></pre></td></tr></table>
</div>
</div><p>通过客户端<code>Client.java</code>的执行流程可以看到，客户端既然要访问目标对象，那么首先需要创建的就是目标对象 TeacherDAO，然后再创建一个代理对象 TeacherDAOProxy，同时将目标对象传递给代理对象，最后再执行代理对象的方法。需要注意的是，虽然执行的是代理对象中的方法，但是代理对象会再去调用目标对象的方法。</p>
<p>这样实现的好处是，在不修改目标对象中的功能的情况下，可以通过修改代理对象来对目标对象进行扩展。例如在 TeacherDAOProxy 类中的 teach 方法内部可以实现对目标对象中 teach 方法的扩充。但由于代理对象和目标对象都需要实现相同的接口，所以会有很多代理类。一旦接口增加了方法，那么目标对象和代理对象都需要维护，即也需要实现这些方法。</p>
<h3 id="动态代理">动态代理</h3>
<p>在动态代理中，代理对象不需要实现接口，但是目标对象需要实现接口，否则不能使用动态代理。动态代理是通过 JDK 中的 java.lang.reflect.Proxy 中的 newProxyInstance 方法创建代理对象的，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">newProxyInstance</span><span class="o">(</span><span class="n">ClassLoader</span> <span class="n">loader</span><span class="o">,</span> 
                                    <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">interfaces</span><span class="o">,</span> 
                                    <span class="n">InvocationHandler</span> <span class="n">h</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IllegalArgumentException</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><p>其中，<code>loader</code>指定当前目标对象使用的类加载器，获取加载器的方法是固定的；<code>interfaces</code>表示目标对象需要实现的接口类型，可以使用泛型的方法确认类型；<code>h</code>表示事件处理，当执行目标对象中方法的时候，会触发事件处理器方法，会把当前执行的目标对象方法作为参数传入。</p>
<p>下面通过示例展示动态代理的使用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// ITeacherDao.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ITeacherDao</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">teach</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// 目标对象
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TeacherDao</span> <span class="kd">implements</span> <span class="n">ITeacherDao</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">teach</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;正在授课...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 代理对象
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProxyFactory</span> <span class="o">{</span>

    <span class="c1">// 维护目标对象
</span><span class="c1"></span>    <span class="kd">private</span> <span class="n">Object</span> <span class="n">target</span><span class="o">;</span>

    <span class="c1">// 当创建对象的时候就对 target 进行初始化
</span><span class="c1"></span>    <span class="kd">public</span> <span class="nf">ProxyFactory</span><span class="o">(</span><span class="n">Object</span> <span class="n">target</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 生成一个代理对象
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getProxyInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">(),</span>
                <span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getInterfaces</span><span class="o">(),</span>
                <span class="k">new</span> <span class="n">InvocationHandler</span><span class="o">()</span> <span class="o">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;JDK 动态代理...&#34;</span><span class="o">);</span>
                        <span class="c1">// 利用反射机制调用目标对象的方法
</span><span class="c1"></span>                        <span class="n">Object</span> <span class="n">invoke</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
                        <span class="k">return</span> <span class="n">invoke</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 首先创建目标对象
</span><span class="c1"></span>        <span class="n">TeacherDao</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TeacherDao</span><span class="o">();</span>

        <span class="c1">// 然后创建代理对象
</span><span class="c1"></span>        <span class="n">ITeacherDao</span> <span class="n">proxyInstance</span> <span class="o">=</span> <span class="o">(</span><span class="n">ITeacherDao</span><span class="o">)</span> <span class="k">new</span> <span class="n">ProxyFactory</span><span class="o">(</span><span class="n">target</span><span class="o">).</span><span class="na">getProxyInstance</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">proxyInstance</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>

        <span class="c1">// 通过代理对象调用目标对象的方法
</span><span class="c1"></span>        <span class="n">proxyInstance</span><span class="o">.</span><span class="na">teach</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">class com.sun.proxy.$Proxy0
JDK 动态代理...
正在授课...
</code></pre></td></tr></table>
</div>
</div><p>这里用到了反射机制，最重要的就是 Proxy.newProxyInstance() 方法以及 invoke() 方法。当<code>proxyInstance.teach();</code>语句在执行的时候，回来到<code>invoke()</code>方法，进而通过反射的方式调用目标对象中的方法。</p>
<h3 id="cglib-代理">CGlib 代理</h3>
<p>静态代理和动态代理（JDK 代理）都会让目标对象实现一个接口，但有时候目标对象只是一个单独的对象，并没有任何接口可以实现，此时可以通过目标对象的子类来实现代理，即 CGlib 代理。</p>
<p>具体的实现方式是：在内存中构建一个子类对象，从而在运行期扩展 Java 类，以实现对目标对象功能上的扩展。例如 Spring AOP。但需要注意的是，被代理的类不能被 final 修饰，否则会抛出异常。目标对象中的方法如果被 final 或 static 修饰，则不会执行目标对象额外的业务方法，即不会有代理的效果。</p>
<blockquote>
<p>Spring AOP 中如何实现代理模式？</p>
<ol>
<li>目标对象需要实现接口，使用 JDK 代理；</li>
<li>目标对象不需要实现接口，使用 CGlib 代理。</li>
</ol>
</blockquote>
<p>在使用 CGlib 代理的时候，<code>代理对象</code>需要实现 MethodInterceptor 接口，并重写 intercept 方法，以便实现对目标对象方法的调用。如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 目标对象
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TeacherDao</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">teach</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;授课...CGlib 代理...&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// ProxyFactory.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProxyFactory</span> <span class="kd">implements</span> <span class="n">MethodInterceptor</span> <span class="o">{</span>

    <span class="c1">// 维护一个目标对象
</span><span class="c1"></span>    <span class="kd">private</span> <span class="n">Object</span> <span class="n">target</span><span class="o">;</span>

    <span class="c1">// 传入被代理的对象
</span><span class="c1"></span>    <span class="kd">public</span> <span class="nf">ProxyFactory</span><span class="o">(</span><span class="n">Object</span> <span class="n">target</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 返回一个代理对象
</span><span class="c1"></span>    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getProxyInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 创建工具类
</span><span class="c1"></span>        <span class="n">Enhancer</span> <span class="n">enhancer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Enhancer</span><span class="o">();</span>
        <span class="c1">// 设置父类
</span><span class="c1"></span>        <span class="n">enhancer</span><span class="o">.</span><span class="na">setSuperclass</span><span class="o">(</span><span class="n">target</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
        <span class="c1">// 设置回调函数
</span><span class="c1"></span>        <span class="n">enhancer</span><span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="c1">// 创建子类对象，即代理对象
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">enhancer</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// 重写 intercept 方法，将会调用目标对象中的方法
</span><span class="c1"></span>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">intercept</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">,</span> <span class="n">MethodProxy</span> <span class="n">methodProxy</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;CGlib 代理开始...&#34;</span><span class="o">);</span>
        <span class="n">Object</span> <span class="n">res</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;CGlib 代理结束...&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 客户端
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 创建目标对象
</span><span class="c1"></span>        <span class="n">TeacherDao</span> <span class="n">target</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TeacherDao</span><span class="o">();</span>

        <span class="c1">// 获取代理对象，并将目标对象传递给代理对象
</span><span class="c1"></span>        <span class="n">TeacherDao</span> <span class="n">proxyInstance</span> <span class="o">=</span> <span class="o">(</span><span class="n">TeacherDao</span><span class="o">)</span> <span class="k">new</span> <span class="n">ProxyFactory</span><span class="o">(</span><span class="n">target</span><span class="o">).</span><span class="na">getProxyInstance</span><span class="o">();</span>

        <span class="c1">// 执行代理对象的方法，触发 intercept 方法，从而实现对目标对象的调用
</span><span class="c1"></span>        <span class="n">proxyInstance</span><span class="o">.</span><span class="na">teach</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">CGlib 代理开始...
授课...CGlib 代理...
CGlib 代理结束...
</code></pre></td></tr></table>
</div>
</div><p><code>proxyInstance.teach();</code>方法执行的时候，会被<code>intercept()</code>方法拦截，进而执行输出语句，而<code>method.invoke(target, args)</code>中的 method 就是 TeacherDao 中的 teach() 方法。最后如果又返回值的话就返回，没有的话就返回 null。</p>
<p>这里需要注意的是：<!-- raw HTML omitted -->代理模式和接下来要讲到的适配器模式的区别，在代理模式下的静态代理，它的代理对象和目标对象都实现了相同的接口，而适配器模式中的对象适配，只是将目标对象委派到了适配器对象中，目标对象和适配器对象并没有实现相同的接口<!-- raw HTML omitted -->。</p>
<h2 id="适配器模式">适配器模式</h2>
<p><code>适配器（Adapter）模式</code>也很好理解，想象以下场景。在现实生活中，经常会出现两个对象因接口不兼容而不能在一起工作的案例，此时需要第三者进行适配。例如将笔记本的画面投影到投影仪上，笔记本的接口是 HDMI 的，而投影仪的接口是 VGA 的，此时需要一个从 HDMI 到 VGA 的转换器（适配器），使用该适配器对两者（HDMI 接口和 VGA 接口）进行适配。</p>
<p>而在软件设计上，如果需要开发的具有某种业务功能的组件在现有的组件库中已经存在，但它们与当前系统的接口规范不兼容，而重新开发这些组件的成本又很高，此时可以使用适配器模式可以很好的解决该问题。也就是说，<!-- raw HTML omitted -->将某个类的接口转换成所希望的另外一个接口，使得原本由于接口不兼容而不能一起工作的那些类能够进行工作<!-- raw HTML omitted -->。</p>
<p>适配器的角色有三个：</p>
<ul>
<li>目标接口：即当前系统所期待的接口；</li>
<li>适配者类：即被访问或被适配的现存组件库中的组件接口；</li>
<li>适配器类：即我们在上面提到的适配器。</li>
</ul>
<p>它们之间的调用关系是：用户调用适配器转换出来的<code>目标接口</code>方法，<code>适配器类</code>再调用<code>适配者类</code>的相关接口方法。适配器模式又细分为<!-- raw HTML omitted -->类适配器模式、对象适配器模式以及接口适配器模式<!-- raw HTML omitted -->。</p>
<h3 id="类适配器模式">类适配器模式</h3>
<p>在类适配器模式下，首先会有一个<code>适配器类（Adapter）</code>，它通过继承适<code>配者类</code>来实现<code>目标类</code>，目标量通过接口来使用。下面通过一个示例来说明类适配器的使用。该示例描述的是通过使用电源适配器给手机充电，由于插排所提供的电压是 220V 的，而手机只能接受 5V，因此需要第三者电源适配器来进行电压的转换。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 适配者类
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Voltage220V</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">output220V</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">src</span> <span class="o">=</span> <span class="n">220</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;电压 = &#34;</span> <span class="o">+</span> <span class="n">src</span> <span class="o">+</span> <span class="s">&#34;V...&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">src</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// IVoltage5V.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IVoltage5V</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="nf">output5V</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// 适配器类
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VoltageAdapter</span> <span class="kd">extends</span> <span class="n">Voltage220V</span> <span class="kd">implements</span> <span class="n">IVoltage5V</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">output5V</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 拿到 220V 电压之后将其处理成 5V 电压，然后返回
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">src</span> <span class="o">=</span> <span class="n">output220V</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">src</span> <span class="o">/</span> <span class="n">44</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">dst</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Phone.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Phone</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">charging</span><span class="o">(</span><span class="n">IVoltage5V</span> <span class="n">iVoltage5V</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">iVoltage5V</span><span class="o">.</span><span class="na">output5V</span><span class="o">()</span> <span class="o">==</span> <span class="n">5</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;电压为 5V，手机开始充电...&#34;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;电压不为 5V，不适合手机充电...&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Client.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Phone</span><span class="o">();</span>
        <span class="n">phone</span><span class="o">.</span><span class="na">charging</span><span class="o">(</span><span class="k">new</span> <span class="n">VoltageAdapter</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">电压 = 220V...
电压为 5V，手机开始充电...
</code></pre></td></tr></table>
</div>
</div><p>在适配者类（Voltage220V）中，它提供的电压是 220V，我们需要通过适配器类（VoltageAdapter）将 220V 转换成手机能够充电的 5V，适配器类通过继承与实现接口的方式进行电压的转换。</p>
<p>需要注意的是，以上的这种类适配器模式有一定的局限性，因为 Java 只支持单继承。此外，适配者类中的<code>output220V()</code>方法也在适配器类（VoltageAdapter）中暴露了出来，增加了使用成本。但正因为继承了适配者类，所以它可以根据需求重写适配者类中的方法，使得适配器类的灵活性增强了。</p>
<h3 id="对象适配器模式">对象适配器模式</h3>
<p>与类适配器不同的是，对象适配器不是使用继承关系连接到适配者类，而是通过<code>委派</code>关系连接到适配者类，即持有适配者类的实例。对象适配器模式是适配器模式常用的一种设计模式。</p>
<p>实现的方式也很简单，直接修改适配器类即可，如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 适配器类
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VoltageAdapter</span> <span class="kd">implements</span> <span class="n">IVoltage5V</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Voltage220V</span> <span class="n">voltage220V</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">VoltageAdapter</span><span class="o">(</span><span class="n">Voltage220V</span> <span class="n">voltage220V</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">voltage220V</span> <span class="o">=</span> <span class="n">voltage220V</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">output5V</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">voltage220V</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">src</span> <span class="o">=</span> <span class="n">voltage220V</span><span class="o">.</span><span class="na">output220V</span><span class="o">();</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">src</span> <span class="o">/</span> <span class="n">44</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">dst</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 客户端也进行了些许的改变
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Phone</span> <span class="n">phone</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Phone</span><span class="o">();</span>
        <span class="n">phone</span><span class="o">.</span><span class="na">charging</span><span class="o">(</span><span class="k">new</span> <span class="n">VoltageAdapter</span><span class="o">(</span><span class="k">new</span> <span class="n">Voltage220V</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="接口适配器模式">接口适配器模式</h3>
<p>当不需要全部实现接口提供的方法时，可以设计一个抽象类去实现该接口，并为该接口中每个方法提供一个默认实现（空方法），那么该抽象类的子类就可以有选择性的覆盖父类的某些方法来实现需求。该适配器模式适用于一个接口不想使用其所有方法的情况。如下所示。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// InterfaceDemo.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">InterfaceDemo</span> <span class="o">{</span>

    <span class="c1">// 只关注 fun1() 方法的使用
</span><span class="c1"></span>    <span class="kt">void</span> <span class="nf">fun1</span><span class="o">();</span>

    <span class="kt">void</span> <span class="nf">fun2</span><span class="o">();</span>

    <span class="kt">void</span> <span class="nf">fun3</span><span class="o">();</span>

    <span class="kt">void</span> <span class="nf">fun4</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// AbsAdapter.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbsAdapter</span> <span class="kd">implements</span> <span class="n">InterfaceDemo</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fun1</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fun2</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fun3</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fun4</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Client.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">AbsAdapter</span> <span class="n">absAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AbsAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">// 真正想要适配的是 fun1() 方法
</span><span class="c1"></span>            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">fun1</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;使用了 fun1 方法&#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="n">absAdapter</span><span class="o">.</span><span class="na">fun1</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">使用了 fun1 方法
</code></pre></td></tr></table>
</div>
</div><p>在 main 方法中我们只关注的是 fun1() 方法的使用，因此可以直接对 fun1() 方法进行重写即可。</p>
<h3 id="小结">小结</h3>
<p>在 Spring MVC 的源码中，HandlerAdapter 使用到了适配器模式，为什么需要使用适配器模式？</p>
<p>这与 Spring MVC 的处理请求的流程有关，Handler 的类型不同，有多重实现方式，那么调用方式就是不确定的。如果需要直接调用 Controller 方法，那么在调用的时候就需要使用 if-else 的方式来判断是哪一个子类然后去执行，如果后面想要对 Controller 进行扩展，就需要修改原来的代码，不易维护。</p>
<h2 id="桥接模式">桥接模式</h2>
<p>TODO</p>
<h2 id="装饰模式">装饰模式</h2>
<p><code>装饰（Decorator）模式</code>的核心是：在不改变现有对象结构的情况下，动态的给对象增加一些职责，即动态的将新的功能附加到对象上。该模式比继承更有弹性、更加灵活。通过设计不同的装饰类，可以创造出多种不同行为的组合。</p>
<p>为什么不用继承呢？因为当扩展一个类的功能的时候，如果通过继承来实现，那么它们之间的耦合度很高，并且随着扩展功能的增多，子类会很膨胀。因此，装饰模式是继承的一种替代方案。</p>
<p>装饰模式主要有以下角色：</p>
<ul>
<li>抽象构件（Component）角色：定义了一个抽象接口，用来规范准备接受附加责任的对象；</li>
<li>具体构件（Concrete Component）角色：实现抽象接口，通过装饰角色为其添加一些职责；</li>
<li>抽象装饰（Decorator）角色：继承抽象构件，并包含具体构件的实例，可以通过其子类扩展具体构件的功能；</li>
<li>具体装饰（Concreate Decorator）角色：实现抽象装饰的相关方法，并给具体构件对象添加附加的责任。</li>
</ul>
<p>假如要设计以下订购咖啡的业务，左侧的 ShortBlack、Decaf、Espresso、LongBlack 表示单品咖啡，即不添加任何调料的咖啡类型，它们所担任的角色就是被修饰者。还有一个抽象的 Drink，它含有一个对咖啡描述的方法 description()，以及计算价格的方法 cost()。由于单品咖啡的种类很多，因此又添加了一个 Coffee。</p>
<p>此外，还有一个 Decorator 表示装饰者，在它的右边有许多装饰者，例如你在买了单品咖啡后是否添加巧克力 Chocolate、是否添加牛奶 Milk、是否添加豆浆 Soy 等。</p>
<p><img src="https://i.loli.net/2020/06/11/vhrnVWTCazeMS7g.png" alt="image.png"></p>
<p>下面通过示例来展开对装饰模式的说明。</p>
<p>首先定义不同的单品咖啡：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// ShortBlack.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShortBlack</span> <span class="kd">extends</span> <span class="n">Coffee</span><span class="o">{</span>

    <span class="kd">public</span> <span class="nf">ShortBlack</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setDes</span><span class="o">(</span><span class="s">&#34;ShortBlack 咖啡...&#34;</span><span class="o">);</span>
        <span class="n">setPrice</span><span class="o">(</span><span class="n">7</span><span class="o">.</span><span class="na">0F</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Decaf.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Decaf</span> <span class="kd">extends</span> <span class="n">Coffee</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">Decaf</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setDes</span><span class="o">(</span><span class="s">&#34;Decaf 咖啡...&#34;</span><span class="o">);</span>
        <span class="n">setPrice</span><span class="o">(</span><span class="n">10</span><span class="o">.</span><span class="na">0F</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Espresso.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Espresso</span> <span class="kd">extends</span> <span class="n">Coffee</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">Espresso</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setDes</span><span class="o">(</span><span class="s">&#34;Espresso 咖啡...&#34;</span><span class="o">);</span>
        <span class="n">setPrice</span><span class="o">(</span><span class="n">6</span><span class="o">.</span><span class="na">0F</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// LongBlack.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LongBlack</span> <span class="kd">extends</span> <span class="n">Coffee</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">LongBlack</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setDes</span><span class="o">(</span><span class="s">&#34;LongBlack 咖啡...&#34;</span><span class="o">);</span>
        <span class="n">setPrice</span><span class="o">(</span><span class="n">11</span><span class="o">.</span><span class="na">0F</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>然后定义 Drink：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Drink</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="n">des</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">price</span> <span class="o">=</span> <span class="n">0</span><span class="o">.</span><span class="na">0F</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDes</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">des</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDes</span><span class="o">(</span><span class="n">String</span> <span class="n">des</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">des</span> <span class="o">=</span> <span class="n">des</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getPrice</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrice</span><span class="o">(</span><span class="kt">float</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 计算费用的方法
</span><span class="c1"></span>    <span class="c1">// 由具体的子类实现
</span><span class="c1"></span>    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">float</span> <span class="nf">cost</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>再创建 Coffee：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Coffee</span> <span class="kd">extends</span> <span class="n">Drink</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">cost</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>再创建 Decorator：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Decorator</span> <span class="kd">extends</span> <span class="n">Drink</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Drink</span> <span class="n">drink</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Decorator</span><span class="o">(</span><span class="n">Drink</span> <span class="n">drink</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">drink</span> <span class="o">=</span> <span class="n">drink</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">cost</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 调料的价格 + 单品咖啡的价格
</span><span class="c1"></span>        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">+</span> <span class="n">drink</span><span class="o">.</span><span class="na">cost</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDes</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">des</span> <span class="o">+</span> <span class="s">&#34; &#34;</span> <span class="o">+</span> <span class="kd">super</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34; &amp;&amp; &#34;</span> <span class="o">+</span> <span class="n">drink</span><span class="o">.</span><span class="na">getDes</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>再创建不同的调料：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// Chocolate.java
</span><span class="c1">// 描述当前调料以及调料的价格
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Chocolate</span> <span class="kd">extends</span> <span class="n">Decorator</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">Chocolate</span><span class="o">(</span><span class="n">Drink</span> <span class="n">drink</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">drink</span><span class="o">);</span>
        <span class="n">setDes</span><span class="o">(</span><span class="s">&#34;Chocolate...&#34;</span><span class="o">);</span>
        <span class="n">setPrice</span><span class="o">(</span><span class="n">2</span><span class="o">.</span><span class="na">0F</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Milk.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Milk</span> <span class="kd">extends</span> <span class="n">Decorator</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">Milk</span><span class="o">(</span><span class="n">Drink</span> <span class="n">drink</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">drink</span><span class="o">);</span>
        <span class="n">setDes</span><span class="o">(</span><span class="s">&#34;Milk...&#34;</span><span class="o">);</span>
        <span class="n">setPrice</span><span class="o">(</span><span class="n">1</span><span class="o">.</span><span class="na">2F</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Soy.java
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Soy</span> <span class="kd">extends</span> <span class="n">Decorator</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">Soy</span><span class="o">(</span><span class="n">Drink</span> <span class="n">drink</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">drink</span><span class="o">);</span>
        <span class="n">setDes</span><span class="o">(</span><span class="s">&#34;Soy...&#34;</span><span class="o">);</span>
        <span class="n">setPrice</span><span class="o">(</span><span class="n">0</span><span class="o">.</span><span class="na">6F</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>最后，通过定义一个咖啡店，来订购一些加了调料的咖啡：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 咖啡店
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CofferStore</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 点一份 LongBlack
</span><span class="c1"></span>        <span class="n">Drink</span> <span class="n">drink</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LongBlack</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;未装饰前：&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">drink</span><span class="o">.</span><span class="na">cost</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">drink</span><span class="o">.</span><span class="na">getDes</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;============================&#34;</span><span class="o">);</span>

        <span class="c1">// 加入牛奶，相当于对 LongBlack 进行了装饰
</span><span class="c1"></span>        <span class="n">drink</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Milk</span><span class="o">(</span><span class="n">drink</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;装饰后：&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">drink</span><span class="o">.</span><span class="na">cost</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">drink</span><span class="o">.</span><span class="na">getDes</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;============================&#34;</span><span class="o">);</span>

        <span class="c1">// 再加入一份巧克力
</span><span class="c1"></span>        <span class="n">drink</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Chocolate</span><span class="o">(</span><span class="n">drink</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;装饰后：&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">drink</span><span class="o">.</span><span class="na">cost</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">drink</span><span class="o">.</span><span class="na">getDes</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>运行结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">未装饰前：
11.0
LongBlack 咖啡...
============================
装饰后：
12.2
Milk... 1.2 &amp;&amp; LongBlack 咖啡...
============================
装饰后：
14.2
Chocolate... 2.0 &amp;&amp; Milk... 1.2 &amp;&amp; LongBlack 咖啡...
</code></pre></td></tr></table>
</div>
</div><p>效果很明显，在没有对 Drink 进行装饰的时候，其输出的仅仅是单品咖啡的价格，而如果对单品咖啡进行了修饰，例如加入了牛奶或者巧克力，那么就会得到装饰后的效果。</p>
<p>Java 中的 I/O 流使用到了装饰模式，如下图所示：</p>
<p><img src="https://i.loli.net/2020/06/11/yWhN9k8qs7J5bIA.png" alt="image.png"></p>
<p>如果看明白了示例，那么也就很容易明白上图的组成：</p>
<ul>
<li>InputStream 相当于示例中的 Drink；</li>
<li>FileInputStream、StringBufferInputStream、ByteArrayInputStream 相当于单品咖啡；</li>
<li>而 FilterInputStream 相当于 Decorator，即装饰着；</li>
<li>而 BufferInputStream、DataInputStream、LineNumberInputStream 相当于调味。</li>
</ul>
<p>在 FilterInputStream 类中有一个 InputStream，这就相当于 Decorator 中有一个 Drink 一样。因此，抽象类 InputStream 相当于<!-- raw HTML omitted -->抽象构件角色<!-- raw HTML omitted -->，FileInputStream、StringBufferInputStream、ByteArrayInputStream 相当于<!-- raw HTML omitted -->具体构件角色<!-- raw HTML omitted -->，FilterInputStream 相当于<!-- raw HTML omitted -->抽象装饰角色<!-- raw HTML omitted -->，而BufferInputStream、DataInputStream、LineNumberInputStream 相当于<!-- raw HTML omitted -->具体装饰角色<!-- raw HTML omitted -->。</p>
<h2 id="组合模式">组合模式</h2>
<p>TODO</p>
<h2 id="外观模式">外观模式</h2>
<p>TODO</p>
<h2 id="享元模式">享元模式</h2>
<p>TODO</p>
<h1 id="行为型模式11-种">行为型模式（11 种）</h1>
<h2 id="模板方法模式">模板方法模式</h2>
<h2 id="责任链模式">责任链模式</h2>
<h2 id="策略模式">策略模式</h2>
<h2 id="迭代器模式">迭代器模式</h2>
<h2 id="观察者模式">观察者模式</h2>
<h2 id="状态模式">状态模式</h2>
<h2 id="命令模式">命令模式</h2>
<p>TODO</p>
<h2 id="中介者模式">中介者模式</h2>
<p>TODO</p>
<h2 id="备忘录模式">备忘录模式</h2>
<p>TODO</p>
<h2 id="解释器模式">解释器模式</h2>
<p>TODO</p>
<h2 id="访问者模式">访问者模式</h2>
<p>TODO</p>
<h1 id="参考">参考</h1>
<ul>
<li><a href="https://www.cnblogs.com/java-my-life/p/?page=4">https://www.cnblogs.com/java-my-life/p/?page=4</a></li>
<li><a href="https://www.iteye.com/blog/smallbug-vip-2276470">https://www.iteye.com/blog/smallbug-vip-2276470</a></li>
<li><a href="https://www.cnblogs.com/pony1223/p/7594803.html">https://www.cnblogs.com/pony1223/p/7594803.html</a></li>
<li><a href="http://c.biancheng.net/view/1317.html">http://c.biancheng.net/view/1317.html</a></li>
<li><a href="https://www.runoob.com/design-pattern/design-pattern-intro.html">https://www.runoob.com/design-pattern/design-pattern-intro.html</a></li>
<li><a href="https://book.douban.com/subject/2334288/">https://book.douban.com/subject/2334288/</a></li>
<li><a href="https://www.cnblogs.com/java-my-life/archive/2012/04/07/2433939.html">https://www.cnblogs.com/java-my-life/archive/2012/04/07/2433939.html</a></li>
</ul>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Carol</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2020-06-11
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">Reward</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="https://i.loli.net/2019/11/17/zU4q6LiShYpHrdZ.png">
        <span>wechat</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="https://i.loli.net/2019/11/17/Xnlykx8W3f6DvFi.png">
        <span>alipay</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/Java/">Java</a>
          <a href="/tags/Desgin-Patterns/">Desgin Patterns</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/2020/05/27/TCP-3-way-and-4-way-handshake/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">三次握手和四次挥手</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/2020/05/07/Java-ReentrantLock/">
            <span class="next-text nav-default">Java 中的 ReentrantLock</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'SirCarol';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/SirCarol_" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/dyfloveslife" class="iconfont icon-github" title="github"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2021
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Carol</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
